# ä¿®å¤ç±»å‹é”™è¯¯ - ä¸€é”®ä¿®å¤

## ğŸ” é—®é¢˜åˆ†æ

ä»ä»£ç ç»“æ„çœ‹åˆ°ï¼š
- ç¬¬414è¡Œï¼š`content = await page.evaluate((pageTitle) => {`
- ç¬¬416-417è¡Œï¼šé”™è¯¯åœ°æ’å…¥äº† `if (!content) content = '';` **åœ¨å‡½æ•°å†…éƒ¨**
- è¿™äº›ä»£ç åº”è¯¥åœ¨ `page.evaluate` è°ƒç”¨**ä¹‹å**ï¼Œè€Œä¸æ˜¯åœ¨å‡½æ•°å†…éƒ¨

## ğŸš€ ä¸€é”®ä¿®å¤

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib && \
python3 << 'PYEOF'
with open('feishu-puppeteer.ts', 'r', encoding='utf-8') as f:
    lines = f.readlines()

# 1. åˆ é™¤é”™è¯¯æ’å…¥çš„ä»£ç ï¼ˆåœ¨ page.evaluate å‡½æ•°å†…éƒ¨çš„ if (!content)ï¼‰
to_remove = []
for i, line in enumerate(lines):
    if i >= 410 and i <= 450:
        # æ£€æŸ¥æ˜¯å¦åœ¨ page.evaluate å†…éƒ¨
        has_start = any('content = await page.evaluate' in lines[j] for j in range(max(0, i-10), i))
        has_end = any('});' in lines[j] for j in range(i, min(i+50, len(lines))))
        if has_start and has_end and 'if (!content) content' in line:
            to_remove.append(i)

# ä»åå¾€å‰åˆ é™¤
for i in reversed(to_remove):
    del lines[i]
    print(f"âœ… åˆ é™¤ç¬¬ {i+1} è¡Œ")

# 2. åœ¨ page.evaluate çš„é—­åˆæ‹¬å·åæ·»åŠ  || ''
for i, line in enumerate(lines):
    if '});' in line and i >= 410:
        if any('content = await page.evaluate' in lines[j] for j in range(max(0, i-50), i)):
            lines[i] = line.replace('});', '}) || \'\';')
            print(f"âœ… ä¿®å¤ç¬¬ {i+1} è¡Œ")
            break

with open('feishu-puppeteer.ts.bak6', 'w', encoding='utf-8') as f:
    f.writelines(lines)
with open('feishu-puppeteer.ts', 'w', encoding='utf-8') as f:
    f.writelines(lines)
PYEOF
cd /www/wwwroot/feihub/backend && npm run build && pm2 restart feihub-backend && echo "âœ… ä¿®å¤å®Œæˆï¼"
```

è¿™ä¸ªå‘½ä»¤ä¼šï¼š
1. åˆ é™¤ç¬¬416-417è¡Œé”™è¯¯æ’å…¥çš„ä»£ç 
2. åœ¨ `page.evaluate` çš„é—­åˆæ‹¬å· `});` åæ·»åŠ  `|| ''` æ¥å¤„ç† null
3. é‡æ–°æ„å»ºå’Œé‡å¯æœåŠ¡

---

æ‰§è¡Œååº”è¯¥èƒ½è§£å†³ç±»å‹é”™è¯¯ï¼

