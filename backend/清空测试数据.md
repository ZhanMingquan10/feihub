# æ¸…ç©ºæµ‹è¯•æ•°æ®

## ğŸ—‘ï¸ æ–¹æ³• 1ï¼šä½¿ç”¨ SQL å‘½ä»¤ï¼ˆæ¨èï¼Œæœ€å¿«ï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend

# è¿æ¥åˆ° PostgreSQLï¼ˆæ ¹æ®ä½ çš„æ•°æ®åº“é…ç½®è°ƒæ•´ï¼‰
# å¦‚æœä½¿ç”¨å®å¡”é¢æ¿çš„ PostgreSQLï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨ postgres ç”¨æˆ·
psql -U postgres -d feihub << EOF
-- åˆ é™¤æ‰€æœ‰æ–‡æ¡£è®°å½•
DELETE FROM "Document";

-- åˆ é™¤æ‰€æœ‰æäº¤è®°å½•
DELETE FROM "DocumentSubmission";

-- é‡ç½®è‡ªå¢ IDï¼ˆå¯é€‰ï¼Œå¦‚æœéœ€è¦ä» 1 å¼€å§‹ï¼‰
-- ALTER SEQUENCE "Document_id_seq" RESTART WITH 1;
-- ALTER SEQUENCE "DocumentSubmission_id_seq" RESTART WITH 1;

-- æŸ¥çœ‹ç»“æœ
SELECT COUNT(*) FROM "Document";
SELECT COUNT(*) FROM "DocumentSubmission";
EOF
```

---

## ğŸ—‘ï¸ æ–¹æ³• 2ï¼šä½¿ç”¨ Prisma Studioï¼ˆå›¾å½¢ç•Œé¢ï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend

# å¯åŠ¨ Prisma Studioï¼ˆåœ¨æœåŠ¡å™¨ä¸Šéœ€è¦ç«¯å£è½¬å‘ï¼‰
npx prisma studio

# ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼ˆéœ€è¦ SSH ç«¯å£è½¬å‘ï¼‰
# æˆ–è€…ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨æ–‡æœ¬æ¨¡å¼
```

**æ³¨æ„**ï¼šPrisma Studio åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨ä¸å¤ªæ–¹ä¾¿ï¼Œå»ºè®®ä½¿ç”¨æ–¹æ³• 1 æˆ– 3ã€‚

---

## ğŸ—‘ï¸ æ–¹æ³• 3ï¼šåˆ›å»ºæ¸…ç†è„šæœ¬ï¼ˆæ¨èï¼Œæœ€å®‰å…¨ï¼‰

åˆ›å»ºä¸€ä¸ªæ¸…ç†è„šæœ¬ï¼š

```bash
cd /www/wwwroot/feihub/backend

# åˆ›å»ºæ¸…ç†è„šæœ¬
cat > clear-test-data.js << 'EOF'
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();

async function clearTestData() {
  try {
    console.log('å¼€å§‹æ¸…ç©ºæµ‹è¯•æ•°æ®...');
    
    // åˆ é™¤æ‰€æœ‰æ–‡æ¡£è®°å½•
    const deletedDocs = await prisma.document.deleteMany({});
    console.log(`âœ… å·²åˆ é™¤ ${deletedDocs.count} æ¡æ–‡æ¡£è®°å½•`);
    
    // åˆ é™¤æ‰€æœ‰æäº¤è®°å½•
    const deletedSubmissions = await prisma.documentSubmission.deleteMany({});
    console.log(`âœ… å·²åˆ é™¤ ${deletedSubmissions.count} æ¡æäº¤è®°å½•`);
    
    console.log('âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç©ºï¼');
  } catch (error) {
    console.error('âŒ æ¸…ç©ºæ•°æ®å¤±è´¥:', error);
    process.exit(1);
  } finally {
    await prisma.$disconnect();
  }
}

clearTestData();
EOF

# è¿è¡Œæ¸…ç†è„šæœ¬
node clear-test-data.js

# åˆ é™¤ä¸´æ—¶è„šæœ¬ï¼ˆå¯é€‰ï¼‰
rm clear-test-data.js
```

---

## ğŸ—‘ï¸ æ–¹æ³• 4ï¼šä½¿ç”¨ Prisma CLIï¼ˆç®€å•ï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend

# ä½¿ç”¨ Prisma æ‰§è¡ŒåŸå§‹ SQL
npx prisma db execute --stdin << EOF
DELETE FROM "Document";
DELETE FROM "DocumentSubmission";
EOF
```

---

## âœ… éªŒè¯æ¸…ç©ºç»“æœ

æ¸…ç©ºåï¼ŒéªŒè¯æ•°æ®æ˜¯å¦å·²åˆ é™¤ï¼š

```bash
cd /www/wwwroot/feihub/backend

# ä½¿ç”¨ Prisma æŸ¥è¯¢
node -e "
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();
(async () => {
  const docCount = await prisma.document.count();
  const subCount = await prisma.documentSubmission.count();
  console.log('æ–‡æ¡£è®°å½•æ•°:', docCount);
  console.log('æäº¤è®°å½•æ•°:', subCount);
  await prisma.\$disconnect();
})();
"
```

---

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½æ•°æ®**ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
   ```bash
   # å¯¼å‡ºæ•°æ®ï¼ˆå¯é€‰ï¼‰
   pg_dump -U postgres -d feihub > feihub_backup_$(date +%Y%m%d).sql
   ```

2. **åªåˆ é™¤æµ‹è¯•æ•°æ®**ï¼šå¦‚æœåªæƒ³åˆ é™¤ç‰¹å®šæ¡ä»¶çš„è®°å½•ï¼Œå¯ä»¥ä¿®æ”¹ SQLï¼š
   ```sql
   -- åªåˆ é™¤æ ‡é¢˜åŒ…å«"æµ‹è¯•"çš„æ–‡æ¡£
   DELETE FROM "Document" WHERE title LIKE '%æµ‹è¯•%';
   
   -- åªåˆ é™¤ç‰¹å®šæ—¥æœŸçš„æ–‡æ¡£
   DELETE FROM "Document" WHERE date < '2025-11-30';
   ```

3. **ä¿ç•™æäº¤è®°å½•**ï¼šå¦‚æœåªæƒ³åˆ é™¤æ–‡æ¡£ä½†ä¿ç•™æäº¤è®°å½•ï¼š
   ```sql
   DELETE FROM "Document";
   -- ä¸åˆ é™¤ DocumentSubmission
   ```

---

## ğŸ¯ å¿«é€Ÿæ¸…ç©ºï¼ˆä¸€é”®æ‰§è¡Œï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend

# ä¸€é”®æ¸…ç©ºæ‰€æœ‰æµ‹è¯•æ•°æ®
node -e "
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();
(async () => {
  try {
    const docs = await prisma.document.deleteMany({});
    const subs = await prisma.documentSubmission.deleteMany({});
    console.log('âœ… å·²åˆ é™¤', docs.count, 'æ¡æ–‡æ¡£è®°å½•');
    console.log('âœ… å·²åˆ é™¤', subs.count, 'æ¡æäº¤è®°å½•');
    console.log('âœ… æµ‹è¯•æ•°æ®å·²æ¸…ç©ºï¼');
  } catch (e) {
    console.error('âŒ é”™è¯¯:', e.message);
  } finally {
    await prisma.\$disconnect();
  }
})();
"
```


