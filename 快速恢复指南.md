# 快速恢复指南

## 服务器重启后恢复服务

### 一键恢复脚本
```bash
cd /www/wwwroot/feihub
bash 服务器重启后恢复服务.sh
```

### 手动恢复步骤

#### 1. 启动宝塔服务
```bash
systemctl start bt
# 或
/etc/init.d/bt start
```

#### 2. 启动后端服务
```bash
cd /www/wwwroot/feihub/backend
pm2 start ecosystem.config.js
# 或
pm2 start dist/index.js --name feihub-backend
pm2 save
```

#### 3. 启动 Nginx
```bash
systemctl start nginx
```

#### 4. 验证服务
```bash
# 检查后端
pm2 list
curl http://localhost:4000/api/documents/hot-keywords

# 检查 Nginx
systemctl status nginx
curl http://localhost/
```

## 常见问题快速修复

### 网站显示 403 Forbidden
```bash
cd /www/wwwroot/feihub
chown -R www:www dist/
chmod -R 755 dist/
if [ ! -d "dist" ]; then
    npm run build
fi
systemctl reload nginx
```

### 网站显示 404 Not Found
```bash
# 检查 dist 目录
ls -la /www/wwwroot/feihub/dist/

# 如果不存在，重新构建
cd /www/wwwroot/feihub
npm run build

# 检查 Nginx 配置
nginx -t
systemctl reload nginx
```

### API 返回 404
```bash
# 检查后端服务
pm2 list
pm2 logs feihub-backend --lines 20

# 检查端口
netstat -tuln | grep 4000

# 重启后端
pm2 restart feihub-backend
```

### 空白页面
```bash
# 检查文件权限
chown -R www:www /www/wwwroot/feihub/dist
chmod -R 755 /www/wwwroot/feihub/dist

# 检查 Nginx 配置
grep -A 10 "location /api" /www/server/panel/vhost/nginx/feihub.top.conf

# 重新加载 Nginx
systemctl reload nginx
```

## 日志查看

### 后端日志
```bash
# 实时日志
pm2 logs feihub-backend

# 最近 100 行
pm2 logs feihub-backend --lines 100 --nostream
```

### Nginx 日志
```bash
# 访问日志
tail -f /www/wwwlogs/access.log

# 错误日志
tail -f /www/wwwlogs/error.log

# 特定站点日志
tail -f /www/wwwlogs/feihub.top.log
```

## 备份和恢复

### 备份数据库
```bash
# PostgreSQL 备份
pg_dump -U postgres feihub > backup_$(date +%Y%m%d).sql
```

### 备份代码
```bash
cd /www/wwwroot/feihub
tar -czf ../feihub_backup_$(date +%Y%m%d).tar.gz .
```

### 恢复代码
```bash
cd /www/wwwroot
tar -xzf feihub_backup_YYYYMMDD.tar.gz
```

