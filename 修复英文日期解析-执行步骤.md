# ä¿®å¤è‹±æ–‡æ—¥æœŸè§£æ - æ‰§è¡Œæ­¥éª¤

## ğŸš€ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# å¤‡ä»½
cp feishu-puppeteer.ts feishu-puppeteer.ts.backup5

# ä½¿ç”¨ Python è„šæœ¬ä¿®å¤
python3 << 'PYTHON_EOF'
import re

file_path = '/www/wwwroot/feihub/backend/src/lib/feishu-puppeteer.ts'

with open(file_path, 'r', encoding='utf-8') as f:
    lines = f.readlines()

# æŸ¥æ‰¾ç¬¬366è¡Œï¼ˆparseChineseDate è°ƒç”¨ï¼‰
for i in range(len(lines)):
    if i == 365 and 'parseChineseDate' in lines[i]:  # ç¬¬366è¡Œï¼ˆ0-based index 365ï¼‰
        indent = len(lines[i]) - len(lines[i].lstrip())
        
        # åœ¨è¿™è¡Œä¹‹å‰æ’å…¥è‹±æ–‡æ—¥æœŸè§£æä»£ç 
        insert_code = [
            ' ' * indent + '// å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼ï¼ˆå¦‚ "Modified January 9, 2024"ï¼‰\n',
            ' ' * indent + 'let parsedDate = null;\n',
            ' ' * indent + 'const englishDateMatch = dateText.match(/(?:Modified|Updated)?\\s*(January|February|March|April|May|June|July|August|September|October|November|December)\\s+(\\d{1,2}),\\s*(\\d{4})/i);\n',
            ' ' * indent + 'if (englishDateMatch) {\n',
            ' ' * (indent + 2) + 'const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];\n',
            ' ' * (indent + 2) + 'const monthIndex = monthNames.findIndex(m => m.toLowerCase() === englishDateMatch[1].toLowerCase());\n',
            ' ' * (indent + 2) + 'if (monthIndex !== -1) {\n',
            ' ' * (indent + 4) + 'const year = parseInt(englishDateMatch[3]);\n',
            ' ' * (indent + 4) + 'const month = monthIndex + 1;\n',
            ' ' * (indent + 4) + 'const day = parseInt(englishDateMatch[2]);\n',
            ' ' * (indent + 4) + 'parsedDate = `${year}-${String(month).padStart(2, "0")}-${String(day).padStart(2, "0")}`;\n',
            ' ' * (indent + 4) + 'console.log(`[Puppeteer] âœ… è§£æè‹±æ–‡æ—¥æœŸæˆåŠŸ: "${dateText}" -> "${parsedDate}"`);\n',
            ' ' * (indent + 2) + '}\n',
            ' ' * indent + '}\n',
            ' ' * indent + '\n',
            ' ' * indent + '// å¦‚æœè‹±æ–‡æ—¥æœŸè§£æå¤±è´¥ï¼Œä½¿ç”¨ parseChineseDate\n',
            ' ' * indent + 'if (!parsedDate) {\n',
            ' ' * (indent + 2) + 'console.log(`[Puppeteer] å‡†å¤‡è§£ææ—¥æœŸ: "${dateText}"`);\n',
        ]
        
        # ä¿®æ”¹ parseChineseDate è°ƒç”¨ï¼Œæ·»åŠ ç¼©è¿›
        lines[i] = ' ' * (indent + 2) + 'dateText = parseChineseDate(dateText);\n'
        
        # æŸ¥æ‰¾å¹¶ä¿®æ”¹åé¢çš„æ—¥å¿—è¾“å‡º
        if i + 1 < len(lines) and 'è§£æåçš„æ—¥æœŸ' in lines[i + 1]:
            lines[i + 1] = ' ' * (indent + 2) + 'console.log(`[Puppeteer] è§£æåçš„æ—¥æœŸ: "${dateText}"`);\n'
            # åœ¨æ—¥å¿—åæ·»åŠ ç»“æŸæ‹¬å·å’Œèµ‹å€¼
            lines.insert(i + 2, ' ' * indent + '}\n')
            lines.insert(i + 3, ' ' * indent + '\n')
            lines.insert(i + 4, ' ' * indent + 'dateText = parsedDate || dateText;\n')
        
        # åœ¨ parseChineseDate è°ƒç”¨ä¹‹å‰æ’å…¥ä»£ç 
        lines[i:i] = insert_code
        break

# æ¸…ç†é‡å¤çš„æ—¥å¿—
new_lines = []
for i, line in enumerate(lines):
    if i > 0 and 'å‡†å¤‡è§£ææ—¥æœŸ' in line and 'å‡†å¤‡è§£ææ—¥æœŸ' in lines[i-1]:
        continue
    if i > 0 and 'è§£æåçš„æ—¥æœŸ' in line and 'è§£æåçš„æ—¥æœŸ' in lines[i-1]:
        continue
    new_lines.append(line)

with open(file_path, 'w', encoding='utf-8') as f:
    f.writelines(new_lines)

print("âœ… ä¿®å¤å®Œæˆ")
PYTHON_EOF

# éªŒè¯ä¿®å¤
echo "ä¿®å¤åçš„ä»£ç ï¼š"
sed -n '355,390p' feishu-puppeteer.ts
```

---

## âœ… ç„¶åé‡æ–°æ„å»º

```bash
cd /www/wwwroot/feihub/backend

npm run build

if [ $? -eq 0 ]; then
    echo "âœ… æ„å»ºæˆåŠŸ"
    pm2 restart feihub-backend
else
    echo "âŒ æ„å»ºå¤±è´¥"
    npm run build 2>&1 | tail -30
fi
```

