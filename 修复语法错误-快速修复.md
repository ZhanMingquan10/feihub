# 修复语法错误 - 快速修复

## 🔍 错误分析

错误：`continue` 不能在函数边界外使用

问题在于：`continue` 语句只能在循环（for/while）内使用，但在 `page.evaluate` 函数内，应该使用 `return` 而不是 `continue`。

## 🚀 快速修复

在服务器上执行：

```bash
cd /www/wwwroot/feihub/backend/src/lib

# 修复语法错误
python3 << 'PYEOF'
import re

file_path = 'feishu-puppeteer.ts'

with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()

original = content

# 查找并修复错误的 continue 语句
# 在 page.evaluate 函数内，continue 应该改为 return null
pattern = r'(if\s*\([^)]*bodyText[^)]*\)\s*\{[^}]*continue;[^}]*\})'

def fix_continue(match):
    return match.group(1).replace('continue;', 'return null;')

content = re.sub(pattern, fix_continue, content)

# 更直接的方法：查找所有包含 bodyText 检查的 continue
lines = content.split('\n')
fixed_lines = []
for i, line in enumerate(lines):
    if 'continue;' in line and 'bodyText' in line:
        # 检查是否在 page.evaluate 函数内
        # 查找前面是否有 page.evaluate
        context = '\n'.join(lines[max(0, i-30):i+1])
        if 'page.evaluate' in context or 'await page.evaluate' in context:
            # 在 evaluate 函数内，改为 return null
            line = line.replace('continue;', 'return null;')
            print(f"修复第 {i+1} 行")
    fixed_lines.append(line)

content = '\n'.join(fixed_lines)

if content != original:
    with open(file_path + '.bak2', 'w', encoding='utf-8') as f:
        f.write(original)
    with open(file_path, 'w', encoding='utf-8') as f:
        f.write(content)
    print("✅ 已修复")
else:
    print("⚠️  未找到需要修复的代码")
PYEOF

# 重新构建
cd /www/wwwroot/feihub/backend
npm run build && pm2 restart feihub-backend && echo "✅ 修复完成！"
```

---

## 📝 或者手动修复

如果上面的脚本不行，可以手动修复：

```bash
cd /www/wwwroot/feihub/backend/src/lib

# 查看第568行附近的代码
sed -n '560,575p' feishu-puppeteer.ts

# 手动修改：将 continue 改为 return null
nano feishu-puppeteer.ts
```

找到第568行，将：
```typescript
if (bodyText && ...) continue;
```

改为：
```typescript
if (bodyText && ...) return null;
```

---

推荐使用**快速修复**命令，直接执行即可。

