# ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶æ·»åŠ ä»£ç  - æ‰§è¡Œæ­¥éª¤

## ðŸš€ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# å¤‡ä»½
cp feishu-puppeteer.ts feishu-puppeteer.ts.backup3

# åˆ›å»ºè¦æ’å…¥çš„ä»£ç 
cat > /tmp/insert_code.txt << 'EOF'

    // é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ ä¹ŸåŠ è½½å®Œæˆï¼ˆé£žä¹¦çš„æ—¥æœŸå…ƒç´ å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼‰
    console.log(`[Puppeteer] é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ...`);

    // ç­‰å¾…æ—¥æœŸå…ƒç´ å‡ºçŽ°ï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰
    try {
      await page.waitForSelector(".doc-info-time-item", { timeout: 10000 });
      console.log(`[Puppeteer] âœ… æ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-item`);

      // ç«‹å³æå–æ—¥æœŸå…ƒç´ çš„å†…å®¹ï¼Œç”¨äºŽè°ƒè¯•
      const dateElementText = await page.evaluate(() => {
        const el = document.querySelector(".doc-info-time-item");
        if (el) {
          return (el.innerText || el.textContent || "").trim();
        }
        return null;
      });
      console.log(`[Puppeteer] ðŸ“… æ—¥æœŸå…ƒç´ å†…å®¹: "${dateElementText}"`);
    } catch (e) {
      console.warn(`[Puppeteer] âš ï¸ æœªæ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-itemï¼Œç»§ç»­æå–...`);
    }

    // å†ç­‰å¾…3ç§’ï¼Œç¡®ä¿æ‰€æœ‰å†…å®¹å®Œå…¨æ¸²æŸ“
    await new Promise(resolve => setTimeout(resolve, 3000));
EOF

# ä½¿ç”¨ awk åœ¨ç¬¬165è¡Œä¹‹åŽæ’å…¥
awk 'NR==165{print; system("cat /tmp/insert_code.txt"); next}1' feishu-puppeteer.ts > feishu-puppeteer.ts.tmp
mv feishu-puppeteer.ts.tmp feishu-puppeteer.ts

echo "âœ… ä»£ç å·²æ·»åŠ "

# éªŒè¯
echo ""
echo "éªŒè¯æ·»åŠ ç»“æžœï¼š"
grep -n "é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ" feishu-puppeteer.ts
grep -n "æ‰¾åˆ°æ—¥æœŸå…ƒç´ " feishu-puppeteer.ts
```

---

## âœ… å¦‚æžœæ·»åŠ æˆåŠŸï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
âœ… ä»£ç å·²æ·»åŠ 

éªŒè¯æ·»åŠ ç»“æžœï¼š
166:    console.log(`[Puppeteer] é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ...`);
170:      console.log(`[Puppeteer] âœ… æ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-item`);
```

---

## ðŸš€ ç„¶åŽé‡æ–°æž„å»ºå’Œéƒ¨ç½²

```bash
cd /www/wwwroot/feihub/backend

# é‡æ–°æž„å»º
npm run build

# æ£€æŸ¥æž„å»ºæ˜¯å¦æˆåŠŸ
if [ $? -eq 0 ]; then
    echo "âœ… æž„å»ºæˆåŠŸ"
    
    # å®Œå…¨é‡å¯ PM2
    pm2 stop feihub-backend
    pm2 delete feihub-backend
    pm2 start npm --name feihub-backend -- run start
    
    # ç­‰å¾…å¯åŠ¨
    sleep 5
    
    echo "âœ… éƒ¨ç½²å®Œæˆ"
else
    echo "âŒ æž„å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥é”™è¯¯ä¿¡æ¯"
    npm run build 2>&1 | tail -20
fi
```

