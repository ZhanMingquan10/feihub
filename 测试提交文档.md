# 测试提交文档功能

## 当前状态
✅ 所有服务正常运行：
- Docker 容器：PostgreSQL + Redis
- 后端 API：http://localhost:4000
- Redis 连接正常
- PostgreSQL 连接正常

## 测试步骤

### 1. 查看后端控制台
提交文档时，后端控制台会显示详细的日志：
- `收到文档提交请求: ...`
- `验证通过，链接: ...`
- `创建提交记录...`
- `添加到任务队列...`
- 或错误信息

### 2. 测试提交
在前端页面：
1. 点击右下角"分享文档"按钮
2. 输入一个飞书文档链接（例如：`https://feishu.cn/docx/...`）
3. 点击"确定"

### 3. 查看错误信息
如果失败，现在会显示更详细的错误信息：
- 如果是 URL 格式错误：会显示"必须是有效的URL"
- 如果是队列错误：会显示"队列服务错误: ..."
- 如果是网络错误：会显示"网络错误，请检查后端服务是否运行"

### 4. 检查浏览器控制台
按 F12 打开浏览器开发者工具：
- 查看 Console 标签页的错误信息
- 查看 Network 标签页的请求详情
  - 找到 `/api/submissions` 请求
  - 查看请求状态和响应内容

## 常见问题

### 问题 1：URL 格式错误
**错误信息**：`必须是有效的URL`

**解决方法**：
- 确保链接以 `http://` 或 `https://` 开头
- 确保是完整的 URL

### 问题 2：队列错误
**错误信息**：`队列服务错误: ...`

**解决方法**：
- 检查 Redis 容器是否运行：`docker ps | findstr redis`
- 如果未运行：`docker-compose up -d`（在 backend 目录）

### 问题 3：网络错误
**错误信息**：`网络错误，请检查后端服务是否运行`

**解决方法**：
- 检查后端服务是否运行：访问 http://localhost:4000/health
- 检查 CORS 配置是否正确

### 问题 4：文档处理失败
如果提交成功但处理失败，检查：
- 后端控制台的错误日志
- 飞书文档链接是否可访问
- DeepSeek API Key 是否正确配置

## 调试信息

提交文档时，后端会输出以下日志：
```
收到文档提交请求: { link: '...' }
验证通过，链接: https://...
创建提交记录...
提交记录已创建: xxx
添加到任务队列...
任务已添加到队列: xxx
提交成功，返回响应
```

如果看到错误，日志会显示具体的错误信息。


