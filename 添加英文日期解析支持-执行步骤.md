# æ·»åŠ è‹±æ–‡æ—¥æœŸè§£ææ”¯æŒ - æ‰§è¡Œæ­¥éª¤

## ğŸ”§ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# å¤‡ä»½
cp feishu-puppeteer.ts feishu-puppeteer.ts.backup5

# æŸ¥æ‰¾ parseChineseDate è°ƒç”¨çš„ä½ç½®
grep -n "parseChineseDate" feishu-puppeteer.ts

# æŸ¥çœ‹è°ƒç”¨ parseChineseDate çš„ä¸Šä¸‹æ–‡
grep -B 3 -A 3 "parseChineseDate" feishu-puppeteer.ts | head -20
```

---

## ğŸ“ ä¿®å¤æ–¹æ¡ˆ

åœ¨è°ƒç”¨ `parseChineseDate` ä¹‹å‰ï¼Œå…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼ã€‚æ‰¾åˆ°è°ƒç”¨ `parseChineseDate` çš„ä½ç½®ï¼ˆå¤§çº¦åœ¨ç¬¬363è¡Œï¼‰ï¼Œä¿®æ”¹ä¸ºï¼š

```typescript
// å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼ï¼ˆå¦‚ "Modified January 9, 2024"ï¼‰
let parsedDate = null;
const englishDateMatch = dateText.match(/(?:Modified|Updated)?\s*(January|February|March|April|May|June|July|August|September|October|November|December)\s+(\d{1,2}),\s*(\d{4})/i);
if (englishDateMatch) {
  const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  const monthIndex = monthNames.findIndex(m => m.toLowerCase() === englishDateMatch[1].toLowerCase());
  if (monthIndex !== -1) {
    const year = parseInt(englishDateMatch[3]);
    const month = monthIndex + 1;
    const day = parseInt(englishDateMatch[2]);
    parsedDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    console.log(`[Puppeteer] âœ… è§£æè‹±æ–‡æ—¥æœŸæˆåŠŸ: "${dateText}" -> "${parsedDate}"`);
  }
}

// å¦‚æœè‹±æ–‡æ—¥æœŸè§£æå¤±è´¥ï¼Œä½¿ç”¨ parseChineseDate
if (!parsedDate) {
  console.log(`[Puppeteer] å‡†å¤‡è§£ææ—¥æœŸ: "${dateText}"`);
  parsedDate = parseChineseDate(dateText);
  console.log(`[Puppeteer] è§£æåçš„æ—¥æœŸ: "${parsedDate}"`);
}

dateText = parsedDate || dateText;
```

---

## ğŸš€ ä½¿ç”¨ Python è„šæœ¬è‡ªåŠ¨ä¿®å¤

```bash
cd /www/wwwroot/feihub/backend/src/lib

python3 << 'PYTHON_EOF'
import re

file_path = '/www/wwwroot/feihub/backend/src/lib/feishu-puppeteer.ts'

with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()

# æŸ¥æ‰¾å¹¶æ›¿æ¢ parseChineseDate çš„è°ƒç”¨
# æ‰¾åˆ° "å‡†å¤‡è§£ææ—¥æœŸ" ä¹‹åï¼ŒparseChineseDate è°ƒç”¨çš„ä½ç½®
pattern = r'(console\.log\(`\[Puppeteer\] å‡†å¤‡è§£ææ—¥æœŸ: "\$\{dateText\}"`\);\s*dateText = parseChineseDate\(dateText\);\s*console\.log\(`\[Puppeteer\] è§£æåçš„æ—¥æœŸ: "\$\{dateText\}"`\);)'

replacement = '''// å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼ï¼ˆå¦‚ "Modified January 9, 2024"ï¼‰
      let parsedDate = null;
      const englishDateMatch = dateText.match(/(?:Modified|Updated)?\\s*(January|February|March|April|May|June|July|August|September|October|November|December)\\s+(\\d{1,2}),\\s*(\\d{4})/i);
      if (englishDateMatch) {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
        const monthIndex = monthNames.findIndex(m => m.toLowerCase() === englishDateMatch[1].toLowerCase());
        if (monthIndex !== -1) {
          const year = parseInt(englishDateMatch[3]);
          const month = monthIndex + 1;
          const day = parseInt(englishDateMatch[2]);
          parsedDate = `\${year}-\${String(month).padStart(2, '0')}-\${String(day).padStart(2, '0')}`;
          console.log(`[Puppeteer] âœ… è§£æè‹±æ–‡æ—¥æœŸæˆåŠŸ: "\${dateText}" -> "\${parsedDate}"`);
        }
      }
      
      // å¦‚æœè‹±æ–‡æ—¥æœŸè§£æå¤±è´¥ï¼Œä½¿ç”¨ parseChineseDate
      if (!parsedDate) {
        console.log(`[Puppeteer] å‡†å¤‡è§£ææ—¥æœŸ: "\${dateText}"`);
        parsedDate = parseChineseDate(dateText);
        console.log(`[Puppeteer] è§£æåçš„æ—¥æœŸ: "\${parsedDate}"`);
      }
      
      dateText = parsedDate || dateText;'''

content = re.sub(pattern, replacement, content, flags=re.MULTILINE)

with open(file_path, 'w', encoding='utf-8') as f:
    f.write(content)

print("âœ… ä¿®å¤å®Œæˆ")
PYTHON_EOF

# éªŒè¯ä¿®å¤
grep -A 20 "è§£æè‹±æ–‡æ—¥æœŸ" feishu-puppeteer.ts | head -25
```

---

## âœ… ç„¶åé‡æ–°æ„å»º

```bash
cd /www/wwwroot/feihub/backend

npm run build

if [ $? -eq 0 ]; then
    echo "âœ… æ„å»ºæˆåŠŸ"
    pm2 restart feihub-backend
else
    echo "âŒ æ„å»ºå¤±è´¥"
    npm run build 2>&1 | tail -30
fi
```

