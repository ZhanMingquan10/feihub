# æ·»åŠ æ™ºèƒ½åˆ†æ®µåŠŸèƒ½

## ğŸ”§ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# å¤‡ä»½
cp feishu-puppeteer.ts feishu-puppeteer.ts.backup12

# æŸ¥çœ‹å†…å®¹æå–åçš„æ¸…ç†ä»£ç ï¼ˆç¬¬656è¡Œé™„è¿‘ï¼‰
sed -n '650,670p' feishu-puppeteer.ts

# åœ¨ "æœ€ç»ˆå†…å®¹é•¿åº¦" ä¹‹å‰æ·»åŠ æ™ºèƒ½åˆ†æ®µé€»è¾‘
python3 << 'PYTHON_EOF'
file_path = '/www/wwwroot/feihub/backend/src/lib/feishu-puppeteer.ts'

with open(file_path, 'r', encoding='utf-8') as f:
    lines = f.readlines()

# æ‰¾åˆ° "æœ€ç»ˆå†…å®¹é•¿åº¦" çš„ä½ç½®
for i in range(len(lines)):
    if 'æœ€ç»ˆå†…å®¹é•¿åº¦' in lines[i]:
        indent = len(lines[i]) - len(lines[i].lstrip())
        
        # åœ¨è¿™è¡Œä¹‹å‰æ’å…¥æ™ºèƒ½åˆ†æ®µä»£ç 
        insert_code = [
            ' ' * indent + '\n',
            ' ' * indent + '// æ™ºèƒ½åˆ†æ®µï¼šåœ¨å¥å·ã€é—®å·ã€æ„Ÿå¹å·åæ·»åŠ æ¢è¡Œ\n',
            ' ' * indent + 'if (content && content.length > 0) {\n',
            ' ' * (indent + 2) + '// åœ¨å¥å·ã€é—®å·ã€æ„Ÿå¹å·åæ·»åŠ æ¢è¡Œï¼ˆå¦‚æœåé¢ä¸æ˜¯æ¢è¡Œï¼‰\n',
            ' ' * (indent + 2) + 'content = content.replace(/([ã€‚ï¼ï¼Ÿ])([^\\n\\r])/g, \'$1\\n$2\');\n',
            ' ' * (indent + 2) + '// æ¸…ç†å¤šä½™çš„ç©ºè¡Œï¼ˆæœ€å¤šä¿ç•™ä¸€ä¸ªç©ºè¡Œï¼‰\n',
            ' ' * (indent + 2) + 'content = content.replace(/\\n{3,}/g, \'\\n\\n\');\n',
            ' ' * (indent + 2) + '// æ¸…ç†è¡Œé¦–è¡Œå°¾ç©ºç™½\n',
            ' ' * (indent + 2) + 'content = content.split(\'\\n\').map(line => line.trim()).join(\'\\n\');\n',
            ' ' * (indent + 2) + 'content = content.trim();\n',
            ' ' * indent + '}\n',
        ]
        
        lines[i:i] = insert_code
        break

with open(file_path, 'w', encoding='utf-8') as f:
    f.writelines(lines)

print("âœ… æ™ºèƒ½åˆ†æ®µåŠŸèƒ½å·²æ·»åŠ ")
PYTHON_EOF

# éªŒè¯ä¿®å¤
echo "ä¿®å¤åçš„ä»£ç ï¼š"
sed -n '650,675p' feishu-puppeteer.ts
```

---

## âœ… ç„¶åé‡æ–°æ„å»º

```bash
cd /www/wwwroot/feihub/backend

npm run build

if [ $? -eq 0 ]; then
    echo "âœ… æ„å»ºæˆåŠŸ"
    pm2 restart feihub-backend
else
    echo "âŒ æ„å»ºå¤±è´¥"
    npm run build 2>&1 | tail -30
fi
```

