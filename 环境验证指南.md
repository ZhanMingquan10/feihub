# FeiHub 环境验证指南

## 🔍 快速验证方法

### 方法一：使用验证脚本（推荐）

1. **在宝塔面板中，点击左侧"终端"**
2. **复制并执行以下命令**：

```bash
cd /www/wwwroot/feihub
bash 环境验证脚本.sh
```

或者直接执行检查命令：

```bash
# 检查 Node.js
node -v
npm -v

# 检查 PM2
pm2 -v

# 检查 Nginx
nginx -v
systemctl status nginx

# 检查 PostgreSQL
psql --version
systemctl status postgresql

# 检查 Redis
redis-cli --version
systemctl status redis
redis-cli ping
```

---

## ✅ 详细检查清单

### 1. Node.js 检查
```bash
node -v
```
**期望结果**：显示 `v18.x.x` 或 `v20.x.x`（版本 >= 18）

```bash
npm -v
```
**期望结果**：显示版本号（如 `9.x.x` 或 `10.x.x`）

---

### 2. PM2 检查
```bash
pm2 -v
```
**期望结果**：显示版本号

```bash
pm2 list
```
**期望结果**：显示进程列表（可能为空，如果还没启动服务）

---

### 3. Nginx 检查
```bash
nginx -v
```
**期望结果**：显示 Nginx 版本

```bash
systemctl status nginx
```
**期望结果**：显示 `active (running)`

```bash
curl http://localhost
```
**期望结果**：返回 HTML 内容或 404（说明 Nginx 在运行）

---

### 4. PostgreSQL 检查
```bash
psql --version
```
**期望结果**：显示 PostgreSQL 版本（如 `psql (PostgreSQL) 15.x`）

```bash
systemctl status postgresql
```
**期望结果**：显示 `active (running)`

```bash
# 测试连接（需要替换密码）
PGPASSWORD=你的数据库密码 psql -U feihub_user -d feihub -h localhost -c "SELECT version();"
```
**期望结果**：显示 PostgreSQL 版本信息

---

### 5. Redis 检查
```bash
redis-cli --version
```
**期望结果**：显示 Redis 版本

```bash
systemctl status redis
```
**期望结果**：显示 `active (running)`

```bash
redis-cli ping
```
**期望结果**：返回 `PONG`

---

### 6. 端口检查
```bash
netstat -tuln | grep -E ":(4000|5432|6379|80|443) "
```
**期望结果**：
- 端口 80：Nginx
- 端口 443：Nginx（SSL）
- 端口 4000：后端服务（如果已启动）
- 端口 5432：PostgreSQL
- 端口 6379：Redis

---

### 7. 项目目录检查
```bash
# 检查项目目录
ls -la /www/wwwroot/feihub

# 检查后端配置
ls -la /www/wwwroot/feihub/backend/.env

# 检查前端构建
ls -la /www/wwwroot/feihub/dist
```

**期望结果**：
- ✅ 项目目录存在
- ✅ `.env` 文件存在（后端配置）
- ✅ `dist` 目录存在（前端构建后）

---

### 8. PM2 进程检查
```bash
pm2 status
```
**期望结果**：如果后端已启动，应该看到 `feihub-backend` 进程

```bash
pm2 logs feihub-backend --lines 20
```
**期望结果**：显示后端日志（如果服务已启动）

---

## 📋 完整验证清单

执行以下命令，逐一检查：

```bash
echo "=== 环境验证 ==="
echo ""
echo "1. Node.js:"
node -v && npm -v
echo ""
echo "2. PM2:"
pm2 -v
echo ""
echo "3. Nginx:"
nginx -v && systemctl status nginx | head -n 3
echo ""
echo "4. PostgreSQL:"
psql --version && systemctl status postgresql | head -n 3
echo ""
echo "5. Redis:"
redis-cli --version && systemctl status redis | head -n 3 && redis-cli ping
echo ""
echo "6. 端口占用:"
netstat -tuln | grep -E ":(4000|5432|6379|80|443) "
echo ""
echo "7. 项目目录:"
ls -d /www/wwwroot/feihub 2>/dev/null && echo "✅ 项目目录存在" || echo "❌ 项目目录不存在"
echo ""
echo "8. PM2 进程:"
pm2 list
```

---

## ✅ 验证通过标准

所有检查应该显示：
- ✅ Node.js 18+ 已安装
- ✅ npm 已安装
- ✅ PM2 已安装
- ✅ Nginx 已安装并运行
- ✅ PostgreSQL 已安装并运行
- ✅ Redis 已安装并运行
- ✅ 端口 80、443、5432、6379 已占用
- ✅ 项目目录存在
- ✅ 后端配置文件存在（如果已上传代码）

---

## 🚨 如果验证失败

### Node.js 未安装
- 在宝塔面板 → 软件商店 → 安装 "Node.js版本管理器"

### PostgreSQL 未安装
- 在宝塔面板 → 软件商店 → 安装 "PostgreSQL"

### Redis 未安装
- 在宝塔面板 → 软件商店 → 安装 "Redis"

### 服务未运行
```bash
# 启动 Nginx
systemctl start nginx

# 启动 PostgreSQL
systemctl start postgresql

# 启动 Redis
systemctl start redis
```

---

## 🎯 下一步

验证通过后，继续按照 `feihub.top部署指南.md` 进行：
1. 创建数据库
2. 上传代码
3. 配置环境变量
4. 启动服务


