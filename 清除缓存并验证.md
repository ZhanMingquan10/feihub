# æ¸…é™¤ç¼“å­˜å¹¶éªŒè¯

## ğŸ” é—®é¢˜åˆ†æ

æ„å»ºå·²ç»æˆåŠŸï¼ŒIP åœ°å€å·²ç»å†™å…¥æ„å»ºæ–‡ä»¶ï¼Œä½†æµè§ˆå™¨è¿˜æ˜¯è¯·æ±‚åŸŸåã€‚è¿™æ˜¯**æµè§ˆå™¨ç¼“å­˜**æˆ–**Nginx ç¼“å­˜**å¯¼è‡´çš„ã€‚

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### ç¬¬ä¸€æ­¥ï¼šæ¸…é™¤ Nginx ç¼“å­˜ï¼ˆå¦‚æœæœ‰ï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# æ£€æŸ¥ Nginx æ˜¯å¦æœ‰ç¼“å­˜é…ç½®
grep -r "proxy_cache" /www/server/panel/vhost/nginx/feihub.top.conf

# å¦‚æœæœ‰ç¼“å­˜ï¼Œæ¸…é™¤å®ƒ
sudo rm -rf /tmp/nginx_cache/* 2>/dev/null || true
```

---

### ç¬¬äºŒæ­¥ï¼šå¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ç¼“å­˜

**æ–¹æ³• 1ï¼šç¡¬åˆ·æ–°ï¼ˆæ¨èï¼‰**
- **Windows/Linux**: `Ctrl + Shift + R` æˆ– `Ctrl + F5`
- **Mac**: `Cmd + Shift + R`

**æ–¹æ³• 2ï¼šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜**
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. é€‰æ‹©"æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

**æ–¹æ³• 3ï¼šæ— ç—•æ¨¡å¼ + ç¡¬åˆ·æ–°**
- æ‰“å¼€æ— ç—•æ¨¡å¼
- è®¿é—® `http://121.40.214.130`
- æŒ‰ `Ctrl + Shift + R` ç¡¬åˆ·æ–°

---

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯æ„å»ºæ–‡ä»¶

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub

# ç¡®è®¤æ„å»ºæ–‡ä»¶ä¸­çš„ API åœ°å€
grep -o "http://[0-9.]*/api" dist/assets/*.js | head -3

# åº”è¯¥çœ‹åˆ°ï¼šhttp://121.40.214.130/api
```

---

### ç¬¬å››æ­¥ï¼šæ£€æŸ¥ Nginx é…ç½®ï¼ˆç¡®ä¿æ²¡æœ‰ç¼“å­˜é™æ€æ–‡ä»¶ï¼‰

åœ¨å®å¡”é¢æ¿ä¸­ï¼š
1. ç½‘ç«™ â†’ `feihub.top` â†’ è®¾ç½® â†’ é…ç½®æ–‡ä»¶
2. æ‰¾åˆ° `location ~* \.(js|css|html)$` éƒ¨åˆ†
3. ç¡®ä¿æ²¡æœ‰ `expires` æˆ– `add_header Cache-Control` è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®ä¸ºï¼š
   ```nginx
   location ~* \.(js|css|html)$ {
       expires -1;
       add_header Cache-Control "no-cache, no-store, must-revalidate";
   }
   ```

æˆ–è€…ç›´æ¥åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# å¤‡ä»½é…ç½®æ–‡ä»¶
sudo cp /www/server/panel/vhost/nginx/feihub.top.conf /www/server/panel/vhost/nginx/feihub.top.conf.bak

# æ·»åŠ æ— ç¼“å­˜é…ç½®ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
sudo sed -i '/location \/ {/a\    add_header Cache-Control "no-cache, no-store, must-revalidate";' /www/server/panel/vhost/nginx/feihub.top.conf

# é‡æ–°åŠ è½½ Nginx
sudo nginx -t && sudo nginx -s reload
```

---

### ç¬¬äº”æ­¥ï¼šéªŒè¯ï¼ˆæœ€é‡è¦ï¼‰

1. **åœ¨æµè§ˆå™¨ä¸­**ï¼š
   - æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
   - åˆ‡æ¢åˆ° "Network" æ ‡ç­¾
   - å‹¾é€‰ "Disable cache"
   - åˆ·æ–°é¡µé¢ï¼ˆF5ï¼‰
   - æŸ¥çœ‹è¯·æ±‚çš„ URLï¼Œåº”è¯¥çœ‹åˆ° `http://121.40.214.130/api/...`

2. **åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­**ï¼š
   - æ‰“å¼€æ§åˆ¶å°ï¼ˆF12 â†’ Consoleï¼‰
   - è¾“å…¥ï¼š`fetch('http://121.40.214.130/api/health').then(r => r.json()).then(console.log)`
   - åº”è¯¥èƒ½çœ‹åˆ° `{status: "ok", ...}`

---

## ğŸš€ å¿«é€Ÿä¿®å¤ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub

# 1. ç¡®è®¤æ„å»ºæ–‡ä»¶
echo "=== æ£€æŸ¥æ„å»ºæ–‡ä»¶ä¸­çš„ API åœ°å€ ==="
grep -o "http://[0-9.]*/api" dist/assets/*.js | head -3

# 2. æ·»åŠ æ— ç¼“å­˜å¤´ï¼ˆå¦‚æœéœ€è¦ï¼‰
echo "=== æ£€æŸ¥ Nginx é…ç½® ==="
grep -A 5 "location / {" /www/server/panel/vhost/nginx/feihub.top.conf | head -10

# 3. é‡æ–°åŠ è½½ Nginx
sudo nginx -t && sudo nginx -s reload && echo "âœ… Nginx å·²é‡æ–°åŠ è½½"
```

---

## ğŸ“ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

å¦‚æœç¡¬åˆ·æ–°åè¿˜æ˜¯è¯·æ±‚åŸŸåï¼Œå¯èƒ½æ˜¯ï¼š

1. **æµè§ˆå™¨æ‰©å±•**ï¼šæŸäº›æ‰©å±•å¯èƒ½ä¿®æ”¹äº†è¯·æ±‚
2. **Service Worker**ï¼šå¦‚æœæœ‰ Service Workerï¼Œéœ€è¦æ¸…é™¤å®ƒ
3. **DNS ç¼“å­˜**ï¼šæœ¬åœ° DNS å¯èƒ½ç¼“å­˜äº†åŸŸå

**æ¸…é™¤ Service Worker**ï¼š
1. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° "Application" æ ‡ç­¾
3. å·¦ä¾§æ‰¾åˆ° "Service Workers"
4. ç‚¹å‡» "Unregister"

**æ¸…é™¤ DNS ç¼“å­˜**ï¼š
- **Windows**: `ipconfig /flushdns`
- **Mac/Linux**: `sudo dscacheutil -flushcache` æˆ– `sudo systemd-resolve --flush-caches`

---

## âœ… éªŒè¯æˆåŠŸæ ‡å¿—

å½“ä¿®å¤æˆåŠŸåï¼Œæµè§ˆå™¨æ§åˆ¶å°åº”è¯¥ï¼š
- âœ… è¯·æ±‚ URL æ˜¯ `http://121.40.214.130/api/...`
- âœ… ä¸å†æœ‰ `ERR_CONNECTION_CLOSED` é”™è¯¯
- âœ… èƒ½å¤ŸæˆåŠŸè·å–æ–‡æ¡£åˆ—è¡¨å’Œçƒ­é—¨å…³é”®è¯


