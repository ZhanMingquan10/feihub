# 服务器恢复最新版本指南

## 方法1：使用 scp 命令（推荐）

在**本地电脑**的 PowerShell 或 CMD 中执行：

```bash
# 替换为您的服务器IP
scp src/App.tsx root@服务器IP:/www/wwwroot/feihub/src/App.tsx

# 同时复制 highlightKeyword.ts
scp src/utils/highlightKeyword.ts root@服务器IP:/www/wwwroot/feihub/src/utils/highlightKeyword.ts
```

## 方法2：在服务器上直接创建文件

在**服务器宝塔终端**中执行以下命令：

### 步骤1：创建 highlightKeyword.ts

```bash
cd /www/wwwroot/feihub
mkdir -p src/utils

# 创建 highlightKeyword.ts（完整内容）
cat > src/utils/highlightKeyword.ts << 'EOF'
import React from "react";
import clsx from "clsx";

export interface HighlightResult {
  text: string;
  parts: Array<{ text: string; highlight: boolean }>;
}

function escapeRegExp(str: string): string {
  return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
}

export function highlightKeyword(text: string, keyword: string): HighlightResult {
  if (!keyword || !text) {
    return { text, parts: [{ text, highlight: false }] };
  }

  const keywords = keyword.trim().split(/\s+/).filter(k => k.length > 0).map(k => k.toLowerCase());
  if (keywords.length === 0) {
    return { text, parts: [{ text, highlight: false }] };
  }

  const regex = new RegExp(`(${keywords.map(k => escapeRegExp(k)).join('|')})`, 'gi');
  const parts: Array<{ text: string; highlight: boolean }> = [];
  let lastIndex = 0;
  let match;

  while ((match = regex.exec(text)) !== null) {
    if (match.index > lastIndex) {
      parts.push({ text: text.substring(lastIndex, match.index), highlight: false });
    }
    parts.push({ text: match[0], highlight: true });
    lastIndex = match.index + match[0].length;
  }

  if (lastIndex < text.length) {
    parts.push({ text: text.substring(lastIndex), highlight: false });
  }

  return { text, parts: parts.length > 0 ? parts : [{ text, highlight: false }] };
}

export function renderHighlightedText(result: HighlightResult, isDarkMode: boolean): React.ReactNode {
  return result.parts.map((part, index) => {
    if (part.highlight) {
      return React.createElement('mark', {
        key: index,
        className: clsx("px-0.5 rounded", isDarkMode ? "bg-yellow-500/30 text-yellow-200 font-medium" : "bg-yellow-300/60 text-yellow-900 font-medium")
      }, part.text);
    }
    return React.createElement('span', { key: index }, part.text);
  });
}
EOF

echo "✅ highlightKeyword.ts 已创建"
```

### 步骤2：复制 App.tsx

**重要**：请将本地 `src/App.tsx` 的完整内容复制到服务器。

**方法A：使用宝塔面板文件管理器**
1. 在本地打开 `src/App.tsx`，全选复制所有内容（Ctrl+A, Ctrl+C）
2. 在服务器宝塔面板中打开 `/www/wwwroot/feihub/src/App.tsx`
3. 全选替换内容（Ctrl+A, Ctrl+V）

**方法B：使用 scp 命令（在本地执行）**
```bash
scp src/App.tsx root@服务器IP:/www/wwwroot/feihub/src/App.tsx
```

### 步骤3：构建和重启

```bash
cd /www/wwwroot/feihub
npm run build

# 如果构建成功，重启服务（如果需要）
# pm2 restart feihub-backend
```

## 验证

执行以下命令验证关键功能是否存在：

```bash
cd /www/wwwroot/feihub

# 检查滚动折叠功能
grep -q "isScrolled" src/App.tsx && echo "✅ 滚动折叠功能存在" || echo "❌ 滚动折叠功能缺失"

# 检查 AI速读 位置
grep -q "right-1 top-1 md:-right-14" src/App.tsx && echo "✅ AI速读位置优化存在" || echo "❌ AI速读位置优化缺失"

# 检查 Share2 图标（如果已修改）
grep -q "Share2" src/App.tsx && echo "✅ Share2 图标存在" || echo "⚠️  使用 Upload 图标"
```

## 注意事项

1. **确保本地文件是最新的**：检查本地 `src/App.tsx` 是否包含所有今天下午的修改
2. **备份服务器文件**：在替换前，建议先备份：
   ```bash
   cp src/App.tsx src/App.tsx.bak_$(date +%Y%m%d_%H%M%S)
   ```
3. **检查文件编码**：确保文件是 UTF-8 编码

