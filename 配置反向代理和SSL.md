# 配置反向代理和 SSL 证书

## ✅ 已完成
- [x] 网站已添加

---

## 🚀 下一步：配置反向代理（用于后端 API）

### 步骤 1：打开站点设置

1. 在宝塔面板的"网站"页面
2. 找到 `feihub.top` 网站
3. 点击右侧的 **"设置"** 按钮

---

### 步骤 2：添加反向代理

1. 在站点设置页面，点击 **"反向代理"** 标签
2. 点击 **"添加反向代理"** 按钮
3. 填写信息：
   - **代理名称**：`api`
   - **目标URL**：`http://127.0.0.1:4000`
   - **发送域名**：`$host`
   - **缓存**：不开启（默认）
4. 点击 **"提交"**

---

### 步骤 3：配置反向代理规则（重要）

1. 在反向代理列表中，找到刚才创建的 `api` 代理
2. 点击右侧的 **"配置文件"** 或 **"编辑"** 按钮
3. 找到 `location /api` 部分，确保配置如下：

```nginx
location /api {
    proxy_pass http://127.0.0.1:4000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

**注意**：
- 如果宝塔面板自动生成的配置不同，需要手动修改
- 确保 `proxy_pass` 指向 `http://127.0.0.1:4000`
- 确保有 `proxy_set_header` 配置

---

### 步骤 4：保存并重载 Nginx

1. 点击 **"保存"** 按钮
2. 如果提示重载 Nginx，点击 **"重载"**

---

## 🔐 配置 SSL 证书（推荐）

### 步骤 1：打开 SSL 设置

1. 在站点设置页面，点击 **"SSL"** 标签
2. 选择 **"Let's Encrypt"** 标签

---

### 步骤 2：申请证书

1. 勾选域名：`feihub.top`（如果支持 www，也勾选 `www.feihub.top`）
2. 点击 **"申请"** 按钮
3. 等待申请完成（可能需要几分钟）

**注意**：
- 申请前确保域名解析已生效
- 确保 80 端口已开放
- 如果申请失败，检查域名解析和端口设置

---

### 步骤 3：启用 HTTPS

1. 申请成功后，点击 **"强制HTTPS"** 按钮
2. 这样所有 HTTP 请求会自动跳转到 HTTPS

---

## ✅ 验证配置

### 1. 测试网站访问

1. 访问：`https://feihub.top`
2. 应该能看到网站首页

---

### 2. 测试 API 连接

在浏览器开发者工具（F12）中：
1. 打开 **"网络"**（Network）标签
2. 刷新页面
3. 查看是否有 `/api/` 开头的请求
4. 检查这些请求是否成功（状态码 200）

---

### 3. 测试功能

1. **查看首页**：应该显示 0 篇文章（数据库是全新的）
2. **分享文档**：尝试分享一个飞书文档链接
3. **查看文档**：点击文档查看详情
4. **搜索功能**：测试搜索功能

---

## 🆘 常见问题

### 问题 1：API 请求失败（404 或 502）

**解决方案**：
1. 检查反向代理配置是否正确
2. 检查后端服务是否运行：`pm2 status`
3. 检查后端日志：`pm2 logs feihub-backend`
4. 检查端口是否被占用：`netstat -tlnp | grep 4000`

---

### 问题 2：SSL 证书申请失败

**解决方案**：
1. 检查域名解析是否正确（A 记录指向服务器 IP）
2. 检查 80 端口是否开放
3. 等待几分钟后重试
4. 检查域名是否已绑定到其他网站

---

### 问题 3：网站无法访问

**解决方案**：
1. 检查 Nginx 是否运行：`systemctl status nginx`
2. 检查网站配置是否正确
3. 检查防火墙端口是否开放（80、443）
4. 检查域名解析是否正确

---

## 📋 检查清单

- [x] 网站已添加
- [ ] 反向代理已配置
- [ ] SSL 证书已申请
- [ ] HTTPS 已启用
- [ ] 网站可以访问
- [ ] API 请求正常
- [ ] 功能测试通过

---

## 🎯 现在执行

1. **配置反向代理**（在站点设置中）
2. **申请 SSL 证书**（在站点设置中）
3. **验证部署**（访问网站测试）

完成后告诉我结果，我们继续！


