# éªŒè¯å¹¶ä¿®å¤æ•°æ®åº“æƒé™

## ğŸ“‹ æ•°æ®åº“ä¿¡æ¯

- **æ•°æ®åº“å**ï¼š`feihub`
- **ç”¨æˆ·å**ï¼š`feihub_user`
- **å¯†ç **ï¼š`JYH6RfxKSNXTR7kN`

---

## ğŸ” ç¬¬ä¸€æ­¥ï¼šéªŒè¯æ•°æ®åº“æ˜¯å¦å­˜åœ¨

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# 1. åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“
sudo -u postgres /www/server/pgsql/bin/psql -l

# æˆ–è€…
psql -h localhost -U postgres -d postgres -c "\l"
```

**åº”è¯¥èƒ½çœ‹åˆ° `feihub` æ•°æ®åº“ã€‚**

---

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šæ›´æ–° .env æ–‡ä»¶

åœ¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸­ï¼š
1. è¿›å…¥ `/www/wwwroot/feihub/backend`
2. ç¼–è¾‘ `.env` æ–‡ä»¶
3. ç¡®ä¿ `DATABASE_URL` ä½¿ç”¨æ­£ç¡®çš„å¯†ç ï¼š

```env
DATABASE_URL=postgresql://feihub_user:JYH6RfxKSNXTR7kN@localhost:5432/feihub?schema=public
```

---

## ğŸ” ç¬¬ä¸‰æ­¥ï¼šæˆäºˆæƒé™

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# æˆäºˆæƒé™
sudo -u postgres /www/server/pgsql/bin/psql <<EOF
GRANT ALL PRIVILEGES ON DATABASE feihub TO feihub_user;
\c feihub
GRANT ALL ON SCHEMA public TO feihub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO feihub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO feihub_user;
\q
EOF
```

---

## âœ… ç¬¬å››æ­¥ï¼šéªŒè¯è¿æ¥

```bash
# æµ‹è¯• feihub_user æ˜¯å¦å¯ä»¥è¿æ¥
cd /www/wwwroot/feihub/backend
psql -h localhost -U feihub_user -d feihub -c "SELECT version();"
```

**å¦‚æœæˆåŠŸï¼Œåº”è¯¥æ˜¾ç¤º PostgreSQL ç‰ˆæœ¬ä¿¡æ¯ã€‚**

---

## ğŸš€ ç¬¬äº”æ­¥ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd /www/wwwroot/feihub/backend
npx prisma migrate deploy
```

---

## ğŸ“ å®Œæ•´æ“ä½œå‘½ä»¤

åœ¨å®å¡”ç»ˆç«¯æŒ‰é¡ºåºæ‰§è¡Œï¼š

```bash
# 1. éªŒè¯æ•°æ®åº“å­˜åœ¨
sudo -u postgres /www/server/pgsql/bin/psql -l | grep feihub

# 2. æˆäºˆæƒé™
sudo -u postgres /www/server/pgsql/bin/psql <<EOF
GRANT ALL PRIVILEGES ON DATABASE feihub TO feihub_user;
\c feihub
GRANT ALL ON SCHEMA public TO feihub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO feihub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO feihub_user;
\q
EOF

# 3. éªŒè¯è¿æ¥
cd /www/wwwroot/feihub/backend
psql -h localhost -U feihub_user -d feihub -c "SELECT 1;"

# 4. è¿è¡Œè¿ç§»
npx prisma migrate deploy
```

---

## ğŸ†˜ å¦‚æœè¿˜æ˜¯æŠ¥é”™

### é”™è¯¯ 1ï¼šæ•°æ®åº“ä¸å­˜åœ¨

å¦‚æœ `sudo -u postgres /www/server/pgsql/bin/psql -l` çœ‹ä¸åˆ° `feihub` æ•°æ®åº“ï¼š

1. **åœ¨å®å¡”é¢æ¿æ£€æŸ¥**
   - æ•°æ®åº“ â†’ PostgreSQL
   - ç¡®è®¤ `feihub` æ•°æ®åº“æ˜¯å¦å­˜åœ¨

2. **å¦‚æœä¸å­˜åœ¨ï¼Œé‡æ–°åˆ›å»º**
   - æ•°æ®åº“ â†’ PostgreSQL â†’ æ·»åŠ æ•°æ®åº“
   - æ•°æ®åº“åï¼š`feihub`
   - ç”¨æˆ·åï¼š`feihub_user`
   - å¯†ç ï¼š`JYH6RfxKSNXTR7kN`

### é”™è¯¯ 2ï¼šæƒé™è¢«æ‹’ç»

å¦‚æœè¿ç§»æ—¶è¿˜æ˜¯æŠ¥æƒé™é”™è¯¯ï¼š

```bash
# å†æ¬¡æˆäºˆæƒé™
sudo -u postgres /www/server/pgsql/bin/psql <<EOF
\c feihub
GRANT ALL ON SCHEMA public TO feihub_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO feihub_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO feihub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON TABLES TO feihub_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA public GRANT ALL ON SEQUENCES TO feihub_user;
\q
EOF
```

---

## âœ… æˆåŠŸæ ‡å¿—

è¿è¡Œ `npx prisma migrate deploy` åï¼Œåº”è¯¥çœ‹åˆ°ï¼š

```
Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma
Datasource "db": PostgreSQL database "feihub", schema "public" at "localhost:5432"

Applying migration `20251128025133_add_content_field`
Applying migration `20251128054005_add_ai_structured_summary`

All migrations have been successfully applied.
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

è¿ç§»æˆåŠŸåï¼Œç»§ç»­ï¼š
1. æ„å»ºåç«¯ï¼š`npm run build`
2. å¯åŠ¨åç«¯ï¼š`pm2 start ecosystem.config.js`
3. æ„å»ºå‰ç«¯ï¼š`cd .. && npm install && npm run build`


