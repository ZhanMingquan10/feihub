# ä¿®å¤ç±»å‹é”™è¯¯ - ç›´æ¥ä¿®æ”¹èµ‹å€¼è¯­å¥

## ğŸš€ æœ€ç›´æ¥çš„æ–¹æ³•

ç›´æ¥åœ¨èµ‹å€¼æ—¶å¤„ç†ç±»å‹ï¼Œä¿®æ”¹ç¬¬414è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# æŸ¥çœ‹ç¬¬414è¡Œ
sed -n '414p' feishu-puppeteer.ts

# æ–¹æ³•1ï¼šä½¿ç”¨ sed ç›´æ¥ä¿®æ”¹ï¼ˆå¦‚æœæ˜¯ä¸€è¡Œï¼‰
# å°† content = await page.evaluate æ”¹ä¸º content = (await page.evaluate as any)
sed -i '414s/content = await page.evaluate/content = (await page.evaluate as any/' feishu-puppeteer.ts

# ç„¶åæ‰¾åˆ°é—­åˆæ‹¬å·å¹¶ä¿®æ”¹
# å…ˆæŸ¥çœ‹é—­åˆæ‹¬å·çš„ä½ç½®
grep -n "});" feishu-puppeteer.ts | head -5

# å‡è®¾é—­åˆæ‹¬å·åœ¨ç¬¬500è¡Œï¼Œä¿®æ”¹ä¸º })) || '';
# éœ€è¦æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´è¡Œå·
```

---

## ğŸ“ æ–¹æ³•2ï¼šä½¿ç”¨ Python æ›´ç²¾ç¡®åœ°ä¿®å¤

```bash
cd /www/wwwroot/feihub/backend/src/lib

python3 << 'PYEOF'
with open('feishu-puppeteer.ts', 'r', encoding='utf-8') as f:
    content = f.read()

# æ–¹æ³•ï¼šåœ¨ content = await page.evaluate åæ·»åŠ ç±»å‹æ–­è¨€
# æŸ¥æ‰¾å¹¶æ›¿æ¢
import re

# æŸ¥æ‰¾ content = await page.evaluate å¹¶æ·»åŠ ç±»å‹æ–­è¨€
pattern = r'(content\s*=\s*)await\s+page\.evaluate'

def add_type_assertion(match):
    return match.group(1) + '(await page.evaluate as any)'

content = re.sub(pattern, add_type_assertion, content)

# æˆ–è€…æ›´ç®€å•ï¼šåœ¨é—­åˆæ‹¬å·åæ·»åŠ  || ''
# æŸ¥æ‰¾æ‰€æœ‰ }); å¹¶æ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ 
lines = content.split('\n')
for i, line in enumerate(lines):
    if '});' in line and i > 410:
        # æ£€æŸ¥å‰é¢æ˜¯å¦æœ‰ content = await page.evaluate
        context = '\n'.join(lines[max(0, i-50):i+1])
        if 'content = await page.evaluate' in context and '}) ||' not in line:
            lines[i] = line.replace('});', '}) || \'\';')
            print(f"ä¿®å¤ç¬¬ {i+1} è¡Œ")

content = '\n'.join(lines)

with open('feishu-puppeteer.ts.bak9', 'w', encoding='utf-8') as f:
    f.write(content)
    
with open('feishu-puppeteer.ts', 'w', encoding='utf-8') as f:
    f.write(content)

print("âœ… ä¿®å¤å®Œæˆ")
PYEOF

cd /www/wwwroot/feihub/backend
npm run build && pm2 restart feihub-backend
```

---

## ğŸ“ æ–¹æ³•3ï¼šä¿®æ”¹ content å˜é‡çš„ç±»å‹å£°æ˜

å¦‚æœä¸Šé¢çš„æ–¹æ³•éƒ½ä¸è¡Œï¼Œå¯ä»¥ä¿®æ”¹ `content` å˜é‡çš„ç±»å‹å£°æ˜ï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# æŸ¥æ‰¾ content å˜é‡çš„å£°æ˜
grep -n "let content\|const content" feishu-puppeteer.ts | head -5

# å°† let content = ""; æ”¹ä¸º let content: string | null = "";
sed -i 's/let content = "";/let content: string | null = "";/' feishu-puppeteer.ts
# æˆ–è€…
sed -i 's/let content = "";/let content: string | null = null;/' feishu-puppeteer.ts

# ç„¶ååœ¨æ‰€æœ‰ä½¿ç”¨ content çš„åœ°æ–¹æ·»åŠ  null æ£€æŸ¥
```

---

è¯·å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤æŸ¥çœ‹ä»£ç ç»“æ„ï¼Œç„¶åå‘Šè¯‰æˆ‘ç»“æœï¼Œæˆ‘ä¼šæä¾›ç²¾ç¡®çš„ä¿®å¤æ–¹æ¡ˆã€‚

