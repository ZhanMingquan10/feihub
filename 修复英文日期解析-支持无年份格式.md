# ä¿®å¤è‹±æ–‡æ—¥æœŸè§£æ - æ”¯æŒæ— å¹´ä»½æ ¼å¼

## ğŸ”§ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# å¤‡ä»½
cp feishu-puppeteer.ts feishu-puppeteer.ts.backup14

# ä¿®å¤è‹±æ–‡æ—¥æœŸè§£æï¼Œæ”¯æŒä¸¤ç§æ ¼å¼ï¼š
# 1. "Modified January 9, 2024" - æœ‰å¹´ä»½
# 2. "Modified August 3" - æ²¡æœ‰å¹´ä»½ï¼ˆé»˜è®¤ä½¿ç”¨å½“å‰å¹´ä»½ï¼‰
python3 << 'PYTHON_EOF'
file_path = '/www/wwwroot/feihub/backend/src/lib/feishu-puppeteer.ts'

with open(file_path, 'r', encoding='utf-8') as f:
    content = f.read()

# æ‰¾åˆ°è‹±æ–‡æ—¥æœŸè§£æçš„ä»£ç ï¼ˆåœ¨ "å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼" ä¹‹åï¼‰
# æ›¿æ¢æ­£åˆ™è¡¨è¾¾å¼å’Œè§£æé€»è¾‘
old_pattern = r'const englishDateMatch = dateText\.match\(/\(\\?:Modified\|Updated\)\?\\s\*\(January\|February\|March\|April\|May\|June\|July\|August\|September\|October\|November\|December\)\\s\+\(\\d\{1,2\}\),\\s\*\(\\d\{4\}\)/i\);'

new_code = '''// å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼ï¼ˆæ”¯æŒä¸¤ç§æ ¼å¼ï¼‰
      let parsedDate = null;
      
      // æ ¼å¼1: "Modified January 9, 2024" - æœ‰å¹´ä»½
      let englishDateMatch = dateText.match(/(?:Modified|Updated)?\\s*(January|February|March|April|May|June|July|August|September|October|November|December)\\s+(\\d{1,2}),\\s*(\\d{4})/i);
      
      // æ ¼å¼2: "Modified August 3" - æ²¡æœ‰å¹´ä»½ï¼ˆé»˜è®¤ä½¿ç”¨å½“å‰å¹´ä»½ï¼‰
      if (!englishDateMatch) {
        englishDateMatch = dateText.match(/(?:Modified|Updated)?\\s*(January|February|March|April|May|June|July|August|September|October|November|December)\\s+(\\d{1,2})(?!,)/i);
      }
      
      if (englishDateMatch) {
        const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        const monthIndex = monthNames.findIndex(m => m.toLowerCase() === englishDateMatch[1].toLowerCase());
        if (monthIndex !== -1) {
          const day = parseInt(englishDateMatch[2]);
          // å¦‚æœæœ‰å¹´ä»½ï¼ˆæ ¼å¼1ï¼‰ï¼Œä½¿ç”¨æå–çš„å¹´ä»½ï¼›å¦åˆ™ä½¿ç”¨å½“å‰å¹´ä»½ï¼ˆæ ¼å¼2ï¼‰
          const year = englishDateMatch[3] ? parseInt(englishDateMatch[3]) : new Date().getFullYear();
          const month = monthIndex + 1;
          parsedDate = `${year}-${String(month).padStart(2, "0")}-${String(day).padStart(2, "0")}`;
          console.log(`[Puppeteer] âœ… è§£æè‹±æ–‡æ—¥æœŸæˆåŠŸ: "${dateText}" -> "${parsedDate}"`);
        }
      }'''

# æ›¿æ¢
import re
content = re.sub(
    r'// å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼[^\n]*\n\s*let parsedDate = null;\s*const englishDateMatch = dateText\.match\(/[^;]+/i\);[^}]+if \(englishDateMatch\) \{[^}]+\}[^}]+\}',
    new_code,
    content,
    flags=re.MULTILINE | re.DOTALL
)

with open(file_path, 'w', encoding='utf-8') as f:
    f.write(content)

print("âœ… è‹±æ–‡æ—¥æœŸè§£æå·²ä¿®å¤")
PYTHON_EOF

# éªŒè¯ä¿®å¤
echo "ä¿®å¤åçš„ä»£ç ï¼š"
sed -n '363,395p' feishu-puppeteer.ts
```

---

## âœ… ç„¶åé‡æ–°æ„å»º

```bash
cd /www/wwwroot/feihub/backend

npm run build

if [ $? -eq 0 ]; then
    echo "âœ… æ„å»ºæˆåŠŸ"
    pm2 restart feihub-backend
else
    echo "âŒ æ„å»ºå¤±è´¥"
    npm run build 2>&1 | tail -30
fi
```

