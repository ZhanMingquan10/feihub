# FeiHub éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡æ¸…å•

### 1. æœåŠ¡å™¨é€‰æ‹©
- **æ¨èé…ç½®**ï¼š
  - CPU: 2æ ¸
  - å†…å­˜: 4GB
  - ç¡¬ç›˜: 40GB SSD
  - å¸¦å®½: 3-5Mbps
- **æ¨èæœåŠ¡å•†**ï¼š
  - é˜¿é‡Œäº‘ ECSï¼ˆè½»é‡åº”ç”¨æœåŠ¡å™¨ï¼‰
  - è…¾è®¯äº‘ CVMï¼ˆè½»é‡åº”ç”¨æœåŠ¡å™¨ï¼‰
  - åä¸ºäº‘ ECS

### 2. åŸŸåå‡†å¤‡ï¼ˆå¯é€‰ä½†æ¨èï¼‰
- è´­ä¹°åŸŸåï¼ˆå¦‚ï¼šfeihub.comï¼‰
- åŸŸåè§£æåˆ°æœåŠ¡å™¨IP

### 3. å¿…éœ€çš„æœåŠ¡
- Node.js 18+ è¿è¡Œç¯å¢ƒ
- PostgreSQL æ•°æ®åº“
- Redis ç¼“å­˜æœåŠ¡
- Nginx åå‘ä»£ç†ï¼ˆæ¨èï¼‰

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæœåŠ¡å™¨åˆå§‹åŒ–

#### 1.1 è¿æ¥æœåŠ¡å™¨
```bash
# ä½¿ç”¨ SSH è¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip
```

#### 1.2 æ›´æ–°ç³»ç»Ÿ
```bash
# CentOS/RHEL
yum update -y

# Ubuntu/Debian
apt update && apt upgrade -y
```

#### 1.3 å®‰è£…åŸºç¡€å·¥å…·
```bash
# CentOS/RHEL
yum install -y git curl wget vim

# Ubuntu/Debian
apt install -y git curl wget vim
```

---

### ç¬¬äºŒæ­¥ï¼šå®‰è£… Node.js

#### 2.1 ä½¿ç”¨ NodeSource å®‰è£… Node.js 18
```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs

# CentOS/RHEL
curl -fsSL https://rpm.nodesource.com/setup_18.x | bash -
yum install -y nodejs
```

#### 2.2 éªŒè¯å®‰è£…
```bash
node -v  # åº”æ˜¾ç¤º v18.x.x
npm -v   # åº”æ˜¾ç¤º 9.x.x
```

#### 2.3 å®‰è£… PM2ï¼ˆè¿›ç¨‹ç®¡ç†å™¨ï¼‰
```bash
npm install -g pm2
```

---

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£… PostgreSQL

#### 3.1 å®‰è£… PostgreSQL
```bash
# Ubuntu/Debian
apt install -y postgresql postgresql-contrib

# CentOS/RHEL
yum install -y postgresql-server postgresql-contrib
postgresql-setup initdb
systemctl enable postgresql
systemctl start postgresql
```

#### 3.2 é…ç½® PostgreSQL
```bash
# åˆ‡æ¢åˆ° postgres ç”¨æˆ·
sudo -u postgres psql

# åœ¨ PostgreSQL å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
CREATE DATABASE feihub;
CREATE USER feihub_user WITH PASSWORD 'your_strong_password';
GRANT ALL PRIVILEGES ON DATABASE feihub TO feihub_user;
\q
```

#### 3.3 é…ç½®è¿œç¨‹è®¿é—®ï¼ˆå¯é€‰ï¼‰
ç¼–è¾‘ `/etc/postgresql/14/main/postgresql.conf`ï¼ˆç‰ˆæœ¬å·å¯èƒ½ä¸åŒï¼‰ï¼š
```conf
listen_addresses = 'localhost'  # æˆ– '*' å…è®¸æ‰€æœ‰IP
```

ç¼–è¾‘ `/etc/postgresql/14/main/pg_hba.conf`ï¼š
```
host    feihub    feihub_user    127.0.0.1/32    md5
```

é‡å¯ PostgreSQLï¼š
```bash
systemctl restart postgresql
```

---

### ç¬¬å››æ­¥ï¼šå®‰è£… Redis

#### 4.1 å®‰è£… Redis
```bash
# Ubuntu/Debian
apt install -y redis-server

# CentOS/RHEL
yum install -y redis
```

#### 4.2 é…ç½® Redis
ç¼–è¾‘ `/etc/redis/redis.conf`ï¼š
```conf
bind 127.0.0.1
protected-mode yes
```

#### 4.3 å¯åŠ¨ Redis
```bash
systemctl enable redis
systemctl start redis
```

éªŒè¯ï¼š
```bash
redis-cli ping  # åº”è¿”å› PONG
```

---

### ç¬¬äº”æ­¥ï¼šå®‰è£… Dockerï¼ˆç”¨äºè¿è¡Œ PostgreSQL å’Œ Redisï¼Œå¯é€‰ï¼‰

å¦‚æœä¸æƒ³æ‰‹åŠ¨å®‰è£… PostgreSQL å’Œ Redisï¼Œå¯ä»¥ä½¿ç”¨ Dockerï¼š

#### 5.1 å®‰è£… Docker
```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com | bash
systemctl enable docker
systemctl start docker
```

#### 5.2 å®‰è£… Docker Compose
```bash
# ä¸‹è½½ Docker Compose
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

#### 5.3 ä½¿ç”¨ Docker Compose å¯åŠ¨æœåŠ¡
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `docker-compose.prod.yml`ï¼š
```yaml
version: '3.8'

services:
  postgres:
    image: postgres:15
    container_name: feihub-postgres
    environment:
      POSTGRES_DB: feihub
      POSTGRES_USER: feihub_user
      POSTGRES_PASSWORD: your_strong_password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "127.0.0.1:5432:5432"
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: feihub-redis
    ports:
      - "127.0.0.1:6379:6379"
    restart: unless-stopped

volumes:
  postgres_data:
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
docker-compose -f docker-compose.prod.yml up -d
```

---

### ç¬¬å…­æ­¥ï¼šéƒ¨ç½²åç«¯ä»£ç 

#### 6.1 å…‹éš†æˆ–ä¸Šä¼ ä»£ç 
```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p /var/www/feihub
cd /var/www/feihub

# æ–¹å¼1ï¼šå¦‚æœä»£ç åœ¨ Git ä»“åº“
git clone https://your-repo-url.git .

# æ–¹å¼2ï¼šä½¿ç”¨ scp ä¸Šä¼ ä»£ç 
# åœ¨æœ¬åœ°æ‰§è¡Œï¼š
# scp -r feihub root@your-server-ip:/var/www/
```

#### 6.2 å®‰è£…åç«¯ä¾èµ–
```bash
cd /var/www/feihub/backend
npm install --production
```

#### 6.3 é…ç½®ç¯å¢ƒå˜é‡
```bash
cd /var/www/feihub/backend
cp .env.example .env  # å¦‚æœå­˜åœ¨
vim .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š
```env
# æœåŠ¡å™¨é…ç½®
PORT=4000
NODE_ENV=production

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://feihub_user:your_strong_password@localhost:5432/feihub

# Redis é…ç½®
REDIS_URL=redis://localhost:6379

# AI API é…ç½®
DEEPSEEK_API_KEY=your_deepseek_api_key
# æˆ–
OPENAI_API_KEY=your_openai_api_key

# CORS é…ç½®ï¼ˆå‰ç«¯åŸŸåï¼‰
CORS_ORIGIN=https://your-domain.com

# å®¢æœå›¾ç‰‡URLï¼ˆå¦‚æœä½¿ç”¨CDNï¼‰
CUSTOMER_SERVICE_IMAGE_URL=https://your-cdn.com/kefu.png
```

#### 6.4 è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
cd /var/www/feihub/backend
npx prisma generate
npx prisma migrate deploy
```

#### 6.5 ä½¿ç”¨ PM2 å¯åŠ¨åç«¯
```bash
cd /var/www/feihub/backend

# åˆ›å»º PM2 é…ç½®æ–‡ä»¶
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'feihub-backend',
    script: 'dist/index.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production'
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    autorestart: true,
    max_memory_restart: '500M'
  }]
};
EOF

# æ„å»º TypeScript
npm run build

# å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js

# ä¿å­˜ PM2 é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
```

---

### ç¬¬ä¸ƒæ­¥ï¼šéƒ¨ç½²å‰ç«¯ä»£ç 

#### 7.1 å®‰è£…å‰ç«¯ä¾èµ–å¹¶æ„å»º
```bash
cd /var/www/feihub

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
cat > .env.production << EOF
VITE_API_BASE=https://api.your-domain.com/api
VITE_CUSTOMER_SERVICE_IMAGE_URL=https://your-cdn.com/kefu.png
EOF

# æ„å»ºå‰ç«¯
npm run build
```

#### 7.2 é…ç½® Nginx
```bash
# å®‰è£… Nginx
apt install -y nginx  # Ubuntu/Debian
# æˆ–
yum install -y nginx  # CentOS/RHEL

# åˆ›å»º Nginx é…ç½®
cat > /etc/nginx/sites-available/feihub << 'EOF'
# å‰ç«¯é…ç½®
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;

    root /var/www/feihub/dist;
    index index.html;

    # å‰ç«¯è·¯ç”±ï¼ˆSPAï¼‰
    location / {
        try_files $uri $uri/ /index.html;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # API ä»£ç†
    location /api {
        proxy_pass http://localhost:4000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF

# åˆ›å»ºè½¯é“¾æ¥ï¼ˆUbuntu/Debianï¼‰
ln -s /etc/nginx/sites-available/feihub /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
nginx -t

# é‡å¯ Nginx
systemctl restart nginx
systemctl enable nginx
```

---

### ç¬¬å…«æ­¥ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰

#### 8.1 ä½¿ç”¨ Let's Encryptï¼ˆå…è´¹ï¼‰
```bash
# å®‰è£… Certbot
apt install -y certbot python3-certbot-nginx  # Ubuntu/Debian
# æˆ–
yum install -y certbot python3-certbot-nginx  # CentOS/RHEL

# è·å–è¯ä¹¦
certbot --nginx -d your-domain.com -d www.your-domain.com

# è‡ªåŠ¨ç»­æœŸ
certbot renew --dry-run
```

#### 8.2 æ›´æ–° Nginx é…ç½®ï¼ˆCertbot ä¼šè‡ªåŠ¨æ›´æ–°ï¼‰
è¯ä¹¦å®‰è£…åï¼ŒNginx é…ç½®ä¼šè‡ªåŠ¨æ›´æ–°ä¸º HTTPSã€‚

---

### ç¬¬ä¹æ­¥ï¼šé…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian (UFW)
ufw allow 22/tcp   # SSH
ufw allow 80/tcp   # HTTP
ufw allow 443/tcp  # HTTPS
ufw enable

# CentOS/RHEL (firewalld)
firewall-cmd --permanent --add-service=ssh
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

---

### ç¬¬åæ­¥ï¼šä¸Šä¼ å®¢æœå›¾ç‰‡

```bash
# å°† kefu.png ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp kefu.png root@your-server-ip:/var/www/feihub/public/

# æˆ–ä½¿ç”¨ CDNï¼ˆæ¨èï¼‰
# ä¸Šä¼ åˆ°é˜¿é‡Œäº‘ OSS æˆ–è…¾è®¯äº‘ COSï¼Œç„¶ååœ¨ .env ä¸­é…ç½® URL
```

---

## ğŸ”§ å¸¸ç”¨è¿ç»´å‘½ä»¤

### PM2 ç®¡ç†
```bash
pm2 list              # æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨
pm2 logs feihub-backend  # æŸ¥çœ‹æ—¥å¿—
pm2 restart feihub-backend  # é‡å¯æœåŠ¡
pm2 stop feihub-backend     # åœæ­¢æœåŠ¡
pm2 delete feihub-backend   # åˆ é™¤æœåŠ¡
```

### æ•°æ®åº“ç®¡ç†
```bash
# è¿æ¥æ•°æ®åº“
psql -U feihub_user -d feihub

# å¤‡ä»½æ•°æ®åº“
pg_dump -U feihub_user feihub > backup.sql

# æ¢å¤æ•°æ®åº“
psql -U feihub_user feihub < backup.sql
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# PM2 æ—¥å¿—
pm2 logs feihub-backend

# Nginx æ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# ç³»ç»Ÿæ—¥å¿—
journalctl -u nginx -f
```

---

## ğŸ“ éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨å·²è´­ä¹°å¹¶é…ç½®
- [ ] Node.js 18+ å·²å®‰è£…
- [ ] PostgreSQL å·²å®‰è£…å¹¶é…ç½®
- [ ] Redis å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] åç«¯ä»£ç å·²éƒ¨ç½²
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] PM2 å·²å¯åŠ¨åç«¯æœåŠ¡
- [ ] å‰ç«¯ä»£ç å·²æ„å»º
- [ ] Nginx å·²é…ç½®
- [ ] SSL è¯ä¹¦å·²å®‰è£…
- [ ] é˜²ç«å¢™å·²é…ç½®
- [ ] åŸŸåå·²è§£æ
- [ ] å®¢æœå›¾ç‰‡å·²ä¸Šä¼ 
- [ ] æµ‹è¯•è®¿é—®æ­£å¸¸

---

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. åç«¯æœåŠ¡æ— æ³•å¯åŠ¨
- æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -tulpn | grep 4000`
- æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
- æŸ¥çœ‹ PM2 æ—¥å¿—ï¼š`pm2 logs feihub-backend`

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
- æ£€æŸ¥ PostgreSQL æ˜¯å¦è¿è¡Œï¼š`systemctl status postgresql`
- æ£€æŸ¥æ•°æ®åº“ç”¨æˆ·å’Œå¯†ç 
- æ£€æŸ¥ DATABASE_URL é…ç½®

### 3. Redis è¿æ¥å¤±è´¥
- æ£€æŸ¥ Redis æ˜¯å¦è¿è¡Œï¼š`redis-cli ping`
- æ£€æŸ¥ REDIS_URL é…ç½®

### 4. å‰ç«¯æ— æ³•è®¿é—® API
- æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ proxy_pass
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- æ£€æŸ¥ CORS é…ç½®

### 5. SSL è¯ä¹¦é—®é¢˜
- ç¡®ä¿åŸŸåå·²æ­£ç¡®è§£æ
- æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 80 å’Œ 443 ç«¯å£
- é‡æ–°ç”³è¯·è¯ä¹¦ï¼š`certbot renew`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- é¡¹ç›® README.md
- æœåŠ¡å™¨æ—¥å¿—
- PM2 æ—¥å¿—
- Nginx æ—¥å¿—

---

## ğŸ‰ éƒ¨ç½²å®Œæˆ

éƒ¨ç½²å®Œæˆåï¼Œè®¿é—® `https://your-domain.com` å³å¯ä½¿ç”¨ FeiHubï¼


