# 迁移成功后的步骤

## ✅ 已完成
- [x] 代码已克隆到服务器
- [x] .env 文件已配置
- [x] 数据库已创建
- [x] 数据库迁移成功

---

## 🚀 下一步操作

### 第一步：构建后端

在宝塔终端执行：

```bash
cd /www/wwwroot/feihub/backend
npm run build
```

**等待构建完成**（可能需要几分钟）

---

### 第二步：启动后端服务

```bash
# 创建日志目录
mkdir -p logs

# 启动服务
pm2 start ecosystem.config.js

# 保存配置
pm2 save

# 设置开机自启（执行后会显示一行命令，复制并执行它）
pm2 startup
```

---

### 第三步：验证后端运行

```bash
# 查看服务状态
pm2 status

# 查看日志（确认没有错误）
pm2 logs feihub-backend --lines 20
```

**应该看到：**
- `pm2 status` 显示 `feihub-backend` 状态为 `online`
- 日志中显示服务已启动，没有错误信息

---

### 第四步：安装前端依赖

```bash
cd /www/wwwroot/feihub
npm install
```

**等待安装完成**（可能需要几分钟）

---

### 第五步：配置前端环境变量

在宝塔文件管理器中：
1. 进入 `/www/wwwroot/feihub`
2. 创建 `.env.production` 文件
3. 添加以下内容：

```env
VITE_API_BASE=https://feihub.top/api
```

**注意**：如果域名不是 `feihub.top`，需要修改为你的实际域名。

---

### 第六步：构建前端

```bash
cd /www/wwwroot/feihub
npm run build
```

**等待构建完成**（可能需要几分钟）

---

### 第七步：上传客服图片

在宝塔文件管理器中：
1. 进入 `/www/wwwroot/feihub/dist`
2. 上传 `kefu.png` 文件到这个目录
   - 如果本地有 `kefu.png`，可以通过宝塔文件管理器上传
   - 或者从本地复制到服务器

---

### 第八步：配置 Nginx

1. **在宝塔面板添加网站**
   - 点击左侧 **"网站"**
   - 点击 **"添加站点"**
   - 填写：
     - **域名**：`feihub.top`（和 `www.feihub.top`）
     - **根目录**：`/www/wwwroot/feihub/dist`
     - **PHP版本**：纯静态
   - 点击 **"提交"**

2. **配置反向代理**（用于后端 API）
   - 点击站点右侧 **"设置"**
   - 点击 **"反向代理"** → **"添加反向代理"**
   - 填写：
     - **代理名称**：`api`
     - **目标URL**：`http://127.0.0.1:4000`
     - **发送域名**：`$host`
   - 点击 **"提交"**

3. **配置反向代理规则**（重要）
   - 在反向代理设置中，点击 **"配置文件"**
   - 找到 `location /api` 部分，确保配置如下：

```nginx
location /api {
    proxy_pass http://127.0.0.1:4000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

4. **配置 SSL 证书**（推荐）
   - 点击站点右侧 **"设置"**
   - 点击 **"SSL"** → **"Let's Encrypt"**
   - 勾选域名，点击 **"申请"**
   - 申请成功后，点击 **"强制HTTPS"**

---

### 第九步：验证部署

1. **访问网站**：`https://feihub.top`
2. **测试功能**：
   - 查看首页（应该显示 0 篇文章）
   - 尝试分享一个文档
   - 查看文档详情

---

## 📋 快速命令汇总

```bash
# 1. 构建后端
cd /www/wwwroot/feihub/backend
npm run build

# 2. 启动后端
mkdir -p logs
pm2 start ecosystem.config.js
pm2 save
pm2 startup

# 3. 验证后端
pm2 status
pm2 logs feihub-backend --lines 20

# 4. 安装前端依赖
cd /www/wwwroot/feihub
npm install

# 5. 构建前端
npm run build
```

---

## 🆘 常见问题

### 问题 1：后端启动失败

```bash
# 查看详细日志
pm2 logs feihub-backend --lines 50

# 检查端口是否被占用
netstat -tlnp | grep 4000
```

### 问题 2：前端构建失败

```bash
# 查看详细错误
cd /www/wwwroot/feihub
npm run build --verbose
```

### 问题 3：网站无法访问

- 检查 Nginx 配置
- 检查域名解析是否正确
- 检查防火墙端口是否开放

---

## ✅ 完成后的检查清单

- [ ] 后端服务运行正常（`pm2 status` 显示 online）
- [ ] 前端已构建（`dist` 目录有文件）
- [ ] Nginx 已配置（网站可以访问）
- [ ] SSL 证书已配置（可以使用 HTTPS）
- [ ] 客服图片已上传（`kefu.png` 在 `dist` 目录）
- [ ] 网站功能正常（可以搜索、分享文档）

---

## 🎉 完成！

完成以上步骤后，你的 FeiHub 网站就可以正常访问了！


