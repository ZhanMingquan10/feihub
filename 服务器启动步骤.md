# æœåŠ¡å™¨å¯åŠ¨æ­¥éª¤ï¼ˆå…¨æ–°æ•°æ®åº“ï¼‰

## âœ… å·²å®Œæˆ
- [x] ä»£ç å·²å…‹éš†åˆ°æœåŠ¡å™¨
- [x] .env æ–‡ä»¶å·²é…ç½®

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–å¹¶å¯åŠ¨æœåŠ¡

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…åç«¯ä¾èµ–

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend
npm install --production
```

**ç­‰å¾…å®‰è£…å®Œæˆ**ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

---

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆåˆ›å»ºå…¨æ–°çš„æ•°æ®åº“è¡¨ï¼‰

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend

# ç”Ÿæˆ Prisma Client
npx prisma generate

# è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆåˆ›å»ºè¡¨ç»“æ„ï¼Œä¸åŒ…å«ä»»ä½•æ•°æ®ï¼‰
npx prisma migrate deploy
```

**è¿™ä¼šåˆ›å»ºå…¨æ–°çš„æ•°æ®åº“è¡¨ç»“æ„ï¼Œæ²¡æœ‰ä»»ä½•æµ‹è¯•æ•°æ®ã€‚**

---

### ç¬¬ä¸‰æ­¥ï¼šæ„å»ºåç«¯

```bash
npm run build
```

---

### ç¬¬å››æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

```bash
# åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# å¯åŠ¨æœåŠ¡
pm2 start ecosystem.config.js

# ä¿å­˜é…ç½®
pm2 save

# è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆæ‰§è¡Œåä¼šæ˜¾ç¤ºä¸€è¡Œå‘½ä»¤ï¼Œå¤åˆ¶å¹¶æ‰§è¡Œå®ƒï¼‰
pm2 startup
```

---

### ç¬¬äº”æ­¥ï¼šéªŒè¯åç«¯è¿è¡Œ

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—ï¼ˆç¡®è®¤æ²¡æœ‰é”™è¯¯ï¼‰
pm2 logs feihub-backend --lines 20
```

**åº”è¯¥çœ‹åˆ°ï¼š**
- `pm2 status` æ˜¾ç¤º `feihub-backend` çŠ¶æ€ä¸º `online`
- æ—¥å¿—ä¸­æ˜¾ç¤ºæœåŠ¡å·²å¯åŠ¨ï¼Œæ²¡æœ‰é”™è¯¯ä¿¡æ¯

---

### ç¬¬å…­æ­¥ï¼šå®‰è£…å‰ç«¯ä¾èµ–

```bash
cd /www/wwwroot/feihub
npm install
```

---

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½®å‰ç«¯ç¯å¢ƒå˜é‡

åœ¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸­ï¼š
1. è¿›å…¥ `/www/wwwroot/feihub`
2. åˆ›å»º `.env.production` æ–‡ä»¶
3. æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```env
VITE_API_BASE=https://feihub.top/api
```

---

### ç¬¬å…«æ­¥ï¼šæ„å»ºå‰ç«¯

```bash
cd /www/wwwroot/feihub
npm run build
```

---

### ç¬¬ä¹æ­¥ï¼šä¸Šä¼ å®¢æœå›¾ç‰‡

åœ¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸­ï¼š
1. è¿›å…¥ `/www/wwwroot/feihub/dist`
2. ä¸Šä¼  `kefu.png` æ–‡ä»¶åˆ°è¿™ä¸ªç›®å½•
   - å¦‚æœæœ¬åœ°æœ‰ `kefu.png`ï¼Œå¯ä»¥é€šè¿‡å®å¡”æ–‡ä»¶ç®¡ç†å™¨ä¸Šä¼ 
   - æˆ–è€…ä»æœ¬åœ°å¤åˆ¶åˆ°æœåŠ¡å™¨

---

### ç¬¬åæ­¥ï¼šé…ç½® Nginx

1. åœ¨å®å¡”é¢æ¿ï¼Œç‚¹å‡»å·¦ä¾§ **"ç½‘ç«™"**
2. ç‚¹å‡» **"æ·»åŠ ç«™ç‚¹"**
3. å¡«å†™ï¼š
   - **åŸŸå**ï¼š`feihub.top`ï¼ˆå’Œ `www.feihub.top`ï¼‰
   - **æ ¹ç›®å½•**ï¼š`/www/wwwroot/feihub/dist`
   - **PHPç‰ˆæœ¬**ï¼šçº¯é™æ€
4. ç‚¹å‡» **"æäº¤"**

5. **é…ç½®åå‘ä»£ç†**ï¼ˆç”¨äºåç«¯ APIï¼‰ï¼š
   - ç‚¹å‡»ç«™ç‚¹å³ä¾§ **"è®¾ç½®"**
   - ç‚¹å‡» **"åå‘ä»£ç†"** â†’ **"æ·»åŠ åå‘ä»£ç†"**
   - å¡«å†™ï¼š
     - **ä»£ç†åç§°**ï¼š`api`
     - **ç›®æ ‡URL**ï¼š`http://127.0.0.1:4000`
     - **å‘é€åŸŸå**ï¼š`$host`
   - ç‚¹å‡» **"æäº¤"**

6. **é…ç½®åå‘ä»£ç†è§„åˆ™**ï¼ˆé‡è¦ï¼‰ï¼š
   - åœ¨åå‘ä»£ç†è®¾ç½®ä¸­ï¼Œç‚¹å‡» **"é…ç½®æ–‡ä»¶"**
   - æ‰¾åˆ° `location /api` éƒ¨åˆ†ï¼Œä¿®æ”¹ä¸ºï¼š

```nginx
location /api {
    proxy_pass http://127.0.0.1:4000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

7. **é…ç½® SSL è¯ä¹¦**ï¼ˆæ¨èï¼‰ï¼š
   - ç‚¹å‡»ç«™ç‚¹å³ä¾§ **"è®¾ç½®"**
   - ç‚¹å‡» **"SSL"** â†’ **"Let's Encrypt"**
   - å‹¾é€‰åŸŸåï¼Œç‚¹å‡» **"ç”³è¯·"**
   - ç”³è¯·æˆåŠŸåï¼Œç‚¹å‡» **"å¼ºåˆ¶HTTPS"**

---

### ç¬¬åä¸€æ­¥ï¼šéªŒè¯éƒ¨ç½²

1. **è®¿é—®ç½‘ç«™**ï¼š`https://feihub.top`
2. **æµ‹è¯•åŠŸèƒ½**ï¼š
   - æŸ¥çœ‹é¦–é¡µï¼ˆåº”è¯¥æ˜¾ç¤º 0 ç¯‡æ–‡ç« ï¼‰
   - å°è¯•åˆ†äº«ä¸€ä¸ªæ–‡æ¡£
   - æŸ¥çœ‹æ–‡æ¡£è¯¦æƒ…

---

## ğŸ” éªŒè¯æ•°æ®åº“æ˜¯å…¨æ–°çš„

å¦‚æœä½ æƒ³ç¡®è®¤æ•°æ®åº“æ˜¯å…¨æ–°çš„ï¼ˆæ²¡æœ‰æµ‹è¯•æ•°æ®ï¼‰ï¼Œå¯ä»¥åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend

# è¿›å…¥ PostgreSQL
psql -U feihub_user -d feihub

# æŸ¥çœ‹æ–‡æ¡£æ•°é‡ï¼ˆåº”è¯¥æ˜¯ 0ï¼‰
SELECT COUNT(*) FROM "Document";

# é€€å‡º
\q
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ•°æ®åº“è¿ç§»å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
cd /www/wwwroot/feihub/backend
node -e "require('dotenv').config(); console.log(process.env.DATABASE_URL)"
```

### é—®é¢˜ 2ï¼šåç«¯å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs feihub-backend --lines 50

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 4000
```

### é—®é¢˜ 3ï¼šå‰ç«¯æ„å»ºå¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
cd /www/wwwroot/feihub
npm run build --verbose
```

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤æ±‡æ€»

```bash
# 1. å®‰è£…åç«¯ä¾èµ–
cd /www/wwwroot/feihub/backend
npm install --production

# 2. è¿è¡Œæ•°æ®åº“è¿ç§»
npx prisma generate
npx prisma migrate deploy

# 3. æ„å»ºåç«¯
npm run build

# 4. å¯åŠ¨åç«¯
mkdir -p logs
pm2 start ecosystem.config.js
pm2 save
pm2 startup

# 5. éªŒè¯åç«¯
pm2 status
pm2 logs feihub-backend --lines 20

# 6. å®‰è£…å‰ç«¯ä¾èµ–
cd /www/wwwroot/feihub
npm install

# 7. æ„å»ºå‰ç«¯
npm run build
```

---

## âœ… å®Œæˆåçš„æ£€æŸ¥æ¸…å•

- [ ] åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆ`pm2 status` æ˜¾ç¤º onlineï¼‰
- [ ] æ•°æ®åº“è¡¨å·²åˆ›å»ºï¼ˆé€šè¿‡ `prisma migrate deploy`ï¼‰
- [ ] å‰ç«¯å·²æ„å»ºï¼ˆ`dist` ç›®å½•æœ‰æ–‡ä»¶ï¼‰
- [ ] Nginx å·²é…ç½®ï¼ˆç½‘ç«™å¯ä»¥è®¿é—®ï¼‰
- [ ] SSL è¯ä¹¦å·²é…ç½®ï¼ˆå¯ä»¥ä½¿ç”¨ HTTPSï¼‰
- [ ] å®¢æœå›¾ç‰‡å·²ä¸Šä¼ ï¼ˆ`kefu.png` åœ¨ `dist` ç›®å½•ï¼‰

---

## ğŸ‰ å®Œæˆï¼

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ çš„ FeiHub ç½‘ç«™å°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ï¼Œæ•°æ®åº“æ˜¯å…¨æ–°çš„ï¼Œæ²¡æœ‰ä»»ä½•æµ‹è¯•æ•°æ®ã€‚


