# æ·»åŠ ç­‰å¾…æ—¥æœŸå…ƒç´ ä»£ç 

## ğŸ” ç¬¬ä¸€æ­¥ï¼šæ‰¾åˆ°æ’å…¥ä½ç½®

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# æ‰¾åˆ° "é¢å¤–ç­‰å¾…3ç§’" çš„ä½ç½®å’Œä¸Šä¸‹æ–‡
grep -n "é¢å¤–ç­‰å¾…3ç§’" feishu-puppeteer.ts
sed -n '165,175p' feishu-puppeteer.ts
```

---

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šæ‰‹åŠ¨æ·»åŠ ä»£ç 

æ‰¾åˆ° "é¢å¤–ç­‰å¾…3ç§’" ä¹‹åçš„ `await new Promise(resolve => setTimeout(resolve, 3000));` è¿™ä¸€è¡Œï¼Œåœ¨è¿™è¡Œ**ä¹‹å**æ·»åŠ ï¼š

```typescript
// é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ ä¹ŸåŠ è½½å®Œæˆï¼ˆé£ä¹¦çš„æ—¥æœŸå…ƒç´ å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼‰
console.log(`[Puppeteer] é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ...`);

// ç­‰å¾…æ—¥æœŸå…ƒç´ å‡ºç°ï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰
try {
  await page.waitForSelector('.doc-info-time-item', { timeout: 10000 });
  console.log(`[Puppeteer] âœ… æ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-item`);
  
  // ç«‹å³æå–æ—¥æœŸå…ƒç´ çš„å†…å®¹ï¼Œç”¨äºè°ƒè¯•
  const dateElementText = await page.evaluate(() => {
    const el = document.querySelector('.doc-info-time-item');
    if (el) {
      return (el.innerText || el.textContent || '').trim();
    }
    return null;
  });
  console.log(`[Puppeteer] ğŸ“… æ—¥æœŸå…ƒç´ å†…å®¹: "${dateElementText}"`);
} catch (e) {
  console.warn(`[Puppeteer] âš ï¸ æœªæ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-itemï¼Œç»§ç»­æå–...`);
}

// å†ç­‰å¾…3ç§’ï¼Œç¡®ä¿æ‰€æœ‰å†…å®¹å®Œå…¨æ¸²æŸ“
await new Promise(resolve => setTimeout(resolve, 3000));
```

---

## ğŸš€ æˆ–è€…ä½¿ç”¨ sed å‘½ä»¤è‡ªåŠ¨æ·»åŠ 

```bash
cd /www/wwwroot/feihub/backend/src/lib

# æ‰¾åˆ°è¡Œå·
line_num=$(grep -n "é¢å¤–ç­‰å¾…3ç§’ï¼Œç¡®ä¿å†…å®¹å®Œå…¨æ¸²æŸ“" feishu-puppeteer.ts | cut -d: -f1)
echo "æ‰¾åˆ°è¡Œå·: $line_num"

# æŸ¥çœ‹ä¸Šä¸‹æ–‡
sed -n "$((line_num-2)),$((line_num+5))p" feishu-puppeteer.ts

# åœ¨ä¸‹ä¸€è¡Œä¹‹åæ’å…¥ï¼ˆéœ€è¦æ‰¾åˆ° await new Promise é‚£ä¸€è¡Œï¼‰
next_line=$(grep -n "await new Promise(resolve => setTimeout(resolve, 3000));" feishu-puppeteer.ts | grep -A 1 "é¢å¤–ç­‰å¾…3ç§’" | tail -1 | cut -d: -f1)
if [ -z "$next_line" ]; then
    # å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±åœ¨ line_num + 1 è¡Œä¹‹å
    next_line=$((line_num + 1))
fi

echo "å°†åœ¨ç¬¬ $next_line è¡Œä¹‹åæ’å…¥ä»£ç "

# æ’å…¥ä»£ç 
sed -i "${next_line}a\\
\\
    // é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ ä¹ŸåŠ è½½å®Œæˆï¼ˆé£ä¹¦çš„æ—¥æœŸå…ƒç´ å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼‰\\
    console.log(\`[Puppeteer] é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ...\`);\\
\\
    // ç­‰å¾…æ—¥æœŸå…ƒç´ å‡ºç°ï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰\\
    try {\\
      await page.waitForSelector('.doc-info-time-item', { timeout: 10000 });\\
      console.log(\`[Puppeteer] âœ… æ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-item\`);\\
\\
      // ç«‹å³æå–æ—¥æœŸå…ƒç´ çš„å†…å®¹ï¼Œç”¨äºè°ƒè¯•\\
      const dateElementText = await page.evaluate(() => {\\
        const el = document.querySelector('.doc-info-time-item');\\
        if (el) {\\
          return (el.innerText || el.textContent || '').trim();\\
        }\\
        return null;\\
      });\\
      console.log(\`[Puppeteer] ğŸ“… æ—¥æœŸå…ƒç´ å†…å®¹: \"\${dateElementText}\"\`);\\
    } catch (e) {\\
      console.warn(\`[Puppeteer] âš ï¸ æœªæ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-itemï¼Œç»§ç»­æå–...\`);\\
    }\\
\\
    // å†ç­‰å¾…3ç§’ï¼Œç¡®ä¿æ‰€æœ‰å†…å®¹å®Œå…¨æ¸²æŸ“\\
    await new Promise(resolve => setTimeout(resolve, 3000));
" feishu-puppeteer.ts

echo "âœ… ä»£ç å·²æ·»åŠ "
```

---

## âœ… éªŒè¯

```bash
grep -n "é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ" feishu-puppeteer.ts
grep -n "æ‰¾åˆ°æ—¥æœŸå…ƒç´ " feishu-puppeteer.ts
```

