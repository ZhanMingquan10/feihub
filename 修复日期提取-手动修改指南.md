# ä¿®å¤æ—¥æœŸæå– - æ‰‹åŠ¨ä¿®æ”¹æŒ‡å—

## ğŸ”§ éœ€è¦ä¿®æ”¹çš„ä½ç½®

### ä¿®æ”¹1: åœ¨ `timeSelectors` æ•°ç»„æœ€å‰é¢æ·»åŠ  `.doc-info-time-item`

**ä½ç½®**ï¼šç¬¬ 224 è¡Œå·¦å³

**åŸä»£ç **ï¼š
```typescript
const timeSelectors = [
  '.updated-time',
  '.doc-updated',
  '.time',
  '[class*="time"]',
  '[class*="date"]',
  '[data-updated]',
  '[data-date]',
  '[data-time]'
];
```

**ä¿®æ”¹ä¸º**ï¼š
```typescript
const timeSelectors = [
  '.doc-info-time-item',  // ä¼˜å…ˆæŸ¥æ‰¾é£ä¹¦æ–‡æ¡£çš„ä¿®æ”¹æ—¶é—´å…ƒç´ 
  '.updated-time',
  '.doc-updated',
  '.time',
  '[class*="time"]',
  '[class*="date"]',
  '[data-updated]',
  '[data-date]',
  '[data-time]'
];
```

---

### ä¿®æ”¹2: åœ¨é¡µé¢åŠ è½½åï¼Œæ·»åŠ ç­‰å¾…æ—¥æœŸå…ƒç´ çš„ä»£ç 

**ä½ç½®**ï¼šç¬¬ 167 è¡Œå·¦å³ï¼ˆåœ¨ `é¢å¤–ç­‰å¾…3ç§’ï¼Œç¡®ä¿å†…å®¹å®Œå…¨æ¸²æŸ“...` ä¹‹åï¼‰

**æ‰¾åˆ°è¿™è¡Œ**ï¼š
```typescript
await new Promise(resolve => setTimeout(resolve, 3000));
```

**åœ¨è¿™è¡Œä¹‹åæ·»åŠ **ï¼š
```typescript
// é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ ä¹ŸåŠ è½½å®Œæˆï¼ˆé£ä¹¦çš„æ—¥æœŸå…ƒç´ å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼‰
console.log(`[Puppeteer] é¢å¤–ç­‰å¾…ï¼Œç¡®ä¿æ—¥æœŸå…ƒç´ åŠ è½½å®Œæˆ...`);

// ç­‰å¾…æ—¥æœŸå…ƒç´ å‡ºç°ï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰
try {
  await page.waitForSelector('.doc-info-time-item', { timeout: 10000 });
  console.log(`[Puppeteer] âœ… æ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-item`);
  
  // ç«‹å³æå–æ—¥æœŸå…ƒç´ çš„å†…å®¹ï¼Œç”¨äºè°ƒè¯•
  const dateElementText = await page.evaluate(() => {
    const el = document.querySelector('.doc-info-time-item');
    if (el) {
      return (el.innerText || el.textContent || '').trim();
    }
    return null;
  });
  console.log(`[Puppeteer] ğŸ“… æ—¥æœŸå…ƒç´ å†…å®¹: "${dateElementText}"`);
} catch (e) {
  console.warn(`[Puppeteer] âš ï¸ æœªæ‰¾åˆ°æ—¥æœŸå…ƒç´  .doc-info-time-itemï¼Œç»§ç»­æå–...`);
}

// å†ç­‰å¾…3ç§’ï¼Œç¡®ä¿æ‰€æœ‰å†…å®¹å®Œå…¨æ¸²æŸ“
await new Promise(resolve => setTimeout(resolve, 3000));
```

---

### ä¿®æ”¹3: åœ¨ pageData æå–çš„æ—¥æœŸéƒ¨åˆ†ï¼Œä¼˜å…ˆæŸ¥æ‰¾ .doc-info-time-item

**ä½ç½®**ï¼šç¬¬ 221 è¡Œå·¦å³ï¼ˆåœ¨ `// 3. æå–æ—¥æœŸ - æŸ¥æ‰¾æ›´æ–°æ—¶é—´` ä¹‹åï¼‰

**æ‰¾åˆ°è¿™è¡Œ**ï¼š
```typescript
// 3. æå–æ—¥æœŸ - æŸ¥æ‰¾æ›´æ–°æ—¶é—´
// æ–¹æ³•1: æŸ¥æ‰¾æ—¶é—´ç›¸å…³çš„å…ƒç´ ï¼ˆä¼˜å…ˆï¼‰
```

**åœ¨è¿™è¡Œä¹‹åï¼Œ`const timeSelectors` ä¹‹å‰æ·»åŠ **ï¼š
```typescript
// ä¼˜å…ˆæŸ¥æ‰¾ .doc-info-time-itemï¼ˆé£ä¹¦æ–‡æ¡£çš„ä¿®æ”¹æ—¶é—´ï¼‰
const docInfoTimeEl = document.querySelector('.doc-info-time-item') as HTMLElement | null;
if (docInfoTimeEl) {
  const timeText = (docInfoTimeEl.innerText || docInfoTimeEl.textContent || '').trim();
  if (timeText && timeText.length > 3) {
    result.date = timeText;
    console.log(`[Puppeteer] âœ… æ‰¾åˆ°æ—¥æœŸæ¥æº: .doc-info-time-item, å†…å®¹: "${timeText}"`);
  }
}

// å¦‚æœè¿˜æ²¡æ‰¾åˆ°ï¼Œç»§ç»­ä½¿ç”¨å…¶ä»–é€‰æ‹©å™¨
```

---

### ä¿®æ”¹4: æ·»åŠ è¯¦ç»†æ—¥å¿—

**ä½ç½®1**ï¼šåœ¨ `const pageData = await page.evaluate(() => {` ä¹‹å

**æ·»åŠ **ï¼š
```typescript
console.log(`[Puppeteer] ğŸ” pageData æå–ç»“æœï¼ˆè¯¦ç»†ï¼‰:`);
console.log(`[Puppeteer] - æ ‡é¢˜: "${pageData.title}"`);
console.log(`[Puppeteer] - ä½œè€…: "${pageData.author}"`);
console.log(`[Puppeteer] - æ—¥æœŸï¼ˆåŸå§‹ï¼Œä» pageDataï¼‰: "${pageData.date}"`);
```

**ä½ç½®2**ï¼šåœ¨ `dateText = parseChineseDate(dateText);` å‰å

**æ‰¾åˆ°**ï¼š
```typescript
dateText = parseChineseDate(dateText);
```

**ä¿®æ”¹ä¸º**ï¼š
```typescript
console.log(`[Puppeteer] å‡†å¤‡è§£ææ—¥æœŸ: "${dateText}"`);
dateText = parseChineseDate(dateText);
console.log(`[Puppeteer] è§£æåçš„æ—¥æœŸ: "${dateText}"`);
```

---

## ğŸš€ ä¿®æ”¹å®Œæˆå

```bash
cd /www/wwwroot/feihub/backend

# é‡æ–°æ„å»º
npm run build

# å®Œå…¨é‡å¯ PM2
pm2 stop feihub-backend
pm2 delete feihub-backend
pm2 start npm --name feihub-backend -- run start
```

---

## ğŸ“ å¦‚æœæ‰‹åŠ¨ä¿®æ”¹å¤ªéº»çƒ¦

æˆ‘å¯ä»¥åˆ›å»ºä¸€ä¸ª Python è„šæœ¬æ¥è‡ªåŠ¨ä¿®å¤ï¼Œæˆ–è€…ä½ å¯ä»¥æŠŠæ–‡ä»¶å†…å®¹å‘ç»™æˆ‘ï¼Œæˆ‘å¸®ä½ ä¿®æ”¹ã€‚

