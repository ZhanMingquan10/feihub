# ç›´æ¥ä¿®å¤è‹±æ–‡æ—¥æœŸè§£æ - æ‰§è¡Œæ­¥éª¤

## ğŸš€ åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# å¤‡ä»½
cp feishu-puppeteer.ts feishu-puppeteer.ts.backup6

# å…ˆåˆ é™¤é‡å¤çš„æ—¥å¿—è¡Œï¼ˆéœ€è¦æ ¹æ®å®é™…è¡Œå·è°ƒæ•´ï¼‰
# æŸ¥çœ‹å½“å‰è¡Œå·
grep -n "å‡†å¤‡è§£ææ—¥æœŸ" feishu-puppeteer.ts
grep -n "è§£æåçš„æ—¥æœŸ" feishu-puppeteer.ts

# åˆ é™¤é‡å¤çš„è¡Œï¼ˆå‡è®¾ç¬¬363å’Œ367è¡Œæ˜¯é‡å¤çš„ï¼‰
sed -i '363d' feishu-puppeteer.ts  # åˆ é™¤é‡å¤çš„ "å‡†å¤‡è§£ææ—¥æœŸ"
sed -i '367d' feishu-puppeteer.ts  # åˆ é™¤é‡å¤çš„ "è§£æåçš„æ—¥æœŸ"

# æŸ¥çœ‹ä¿®å¤åçš„ä»£ç 
sed -n '360,370p' feishu-puppeteer.ts
```

---

## ğŸ”§ ç„¶åä½¿ç”¨ Python è„šæœ¬ç²¾ç¡®æ’å…¥

```bash
python3 << 'PYTHON_EOF'
file_path = '/www/wwwroot/feihub/backend/src/lib/feishu-puppeteer.ts'

with open(file_path, 'r', encoding='utf-8') as f:
    lines = f.readlines()

# æ‰¾åˆ° "å‡†å¤‡è§£ææ—¥æœŸ" å’Œ parseChineseDate çš„ä½ç½®
for i in range(len(lines)):
    if 'å‡†å¤‡è§£ææ—¥æœŸ' in lines[i] and i + 1 < len(lines) and 'parseChineseDate' in lines[i + 1]:
        indent = len(lines[i]) - len(lines[i].lstrip())
        
        # åœ¨ "å‡†å¤‡è§£ææ—¥æœŸ" ä¹‹åæ’å…¥è‹±æ–‡æ—¥æœŸè§£æä»£ç 
        insert_code = [
            ' ' * indent + '// å…ˆå°è¯•è§£æè‹±æ–‡æ—¥æœŸæ ¼å¼ï¼ˆå¦‚ "Modified January 9, 2024"ï¼‰\n',
            ' ' * indent + 'let parsedDate = null;\n',
            ' ' * indent + 'const englishDateMatch = dateText.match(/(?:Modified|Updated)?\\s*(January|February|March|April|May|June|July|August|September|October|November|December)\\s+(\\d{1,2}),\\s*(\\d{4})/i);\n',
            ' ' * indent + 'if (englishDateMatch) {\n',
            ' ' * (indent + 2) + 'const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];\n',
            ' ' * (indent + 2) + 'const monthIndex = monthNames.findIndex(m => m.toLowerCase() === englishDateMatch[1].toLowerCase());\n',
            ' ' * (indent + 2) + 'if (monthIndex !== -1) {\n',
            ' ' * (indent + 4) + 'const year = parseInt(englishDateMatch[3]);\n',
            ' ' * (indent + 4) + 'const month = monthIndex + 1;\n',
            ' ' * (indent + 4) + 'const day = parseInt(englishDateMatch[2]);\n',
            ' ' * (indent + 4) + 'parsedDate = `${year}-${String(month).padStart(2, "0")}-${String(day).padStart(2, "0")}`;\n',
            ' ' * (indent + 4) + 'console.log(`[Puppeteer] âœ… è§£æè‹±æ–‡æ—¥æœŸæˆåŠŸ: "${dateText}" -> "${parsedDate}"`);\n',
            ' ' * (indent + 2) + '}\n',
            ' ' * indent + '}\n',
            ' ' * indent + '\n',
            ' ' * indent + '// å¦‚æœè‹±æ–‡æ—¥æœŸè§£æå¤±è´¥ï¼Œä½¿ç”¨ parseChineseDate\n',
            ' ' * indent + 'if (!parsedDate) {\n',
        ]
        
        # ä¿®æ”¹ parseChineseDate è°ƒç”¨ï¼Œæ·»åŠ ç¼©è¿›
        if 'parseChineseDate' in lines[i + 1]:
            lines[i + 1] = ' ' * (indent + 2) + lines[i + 1].lstrip()
        
        # æŸ¥æ‰¾ "è§£æåçš„æ—¥æœŸ" æ—¥å¿—
        if i + 2 < len(lines) and 'è§£æåçš„æ—¥æœŸ' in lines[i + 2]:
            lines[i + 2] = ' ' * (indent + 2) + lines[i + 2].lstrip()
            # åœ¨æ—¥å¿—åæ·»åŠ ç»“æŸæ‹¬å·å’Œèµ‹å€¼
            lines.insert(i + 3, ' ' * indent + '} else {\n')
            lines.insert(i + 4, ' ' * indent + '  dateText = parsedDate;\n')
            lines.insert(i + 5, ' ' * indent + '}\n')
        
        # åœ¨ "å‡†å¤‡è§£ææ—¥æœŸ" ä¹‹åæ’å…¥ä»£ç 
        lines[i+1:i+1] = insert_code
        break

with open(file_path, 'w', encoding='utf-8') as f:
    f.writelines(lines)

print("âœ… ä¿®å¤å®Œæˆ")
PYTHON_EOF

# éªŒè¯ä¿®å¤
echo "ä¿®å¤åçš„ä»£ç ï¼š"
sed -n '355,390p' feishu-puppeteer.ts
```

---

## âœ… ç„¶åé‡æ–°æ„å»º

```bash
cd /www/wwwroot/feihub/backend

npm run build

if [ $? -eq 0 ]; then
    echo "âœ… æ„å»ºæˆåŠŸ"
    pm2 restart feihub-backend
else
    echo "âŒ æ„å»ºå¤±è´¥"
    npm run build 2>&1 | tail -30
fi
```

