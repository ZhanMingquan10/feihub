# ä¿®å¤å†…å®¹æå–é—®é¢˜ - ç›´æ¥ä¿®å¤

## ğŸ” é—®é¢˜åˆ†æ

ä»æ—¥å¿—çœ‹åˆ°ï¼š
- ç­‰å¾…æ—¶æ£€æµ‹åˆ° 347 å­—çš„å†…å®¹
- ä½† `page.evaluate` æå–æ—¶åªæå–åˆ° 29 å­—ç¬¦ï¼š"Help CenterKeyboard Shortcuts"
- è¯´æ˜é€‰æ‹©å™¨åŒ¹é…åˆ°äº†å¯¼èˆªæ ï¼Œè€Œä¸æ˜¯æ­£æ–‡

## ğŸš€ ä¿®å¤æ–¹æ¡ˆ

éœ€è¦åœ¨ `page.evaluate` å‡½æ•°å†…çš„å†…å®¹æå–å¾ªç¯ä¸­ï¼Œæ·»åŠ éªŒè¯é€»è¾‘ï¼Œè·³è¿‡åŒ…å« "Help Center"ã€"Keyboard Shortcuts" çš„å†…å®¹ã€‚

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
cd /www/wwwroot/feihub/backend/src/lib

# æŸ¥çœ‹å†…å®¹æå–çš„ä»£ç ä½ç½®
grep -n "ä»é¡µé¢ç›´æ¥æå–å†…å®¹\|return text.trim()" feishu-puppeteer.ts | head -10

# æŸ¥çœ‹å…·ä½“çš„æå–ä»£ç 
grep -A 50 "ä»é¡µé¢ç›´æ¥æå–å†…å®¹" feishu-puppeteer.ts | head -60
```

æŠŠè¾“å‡ºå‘ç»™æˆ‘ï¼Œæˆ‘ä¼šæ ¹æ®å®é™…ä»£ç æä¾›ç²¾ç¡®çš„ä¿®å¤æ–¹æ¡ˆã€‚

---

## ğŸ“ æˆ–è€…ç›´æ¥ä¿®å¤ï¼ˆå¦‚æœä»£ç ç»“æ„å·²çŸ¥ï¼‰

```bash
cd /www/wwwroot/feihub/backend/src/lib

python3 << 'PYEOF'
with open('feishu-puppeteer.ts', 'r', encoding='utf-8') as f:
    lines = f.readlines()

# æŸ¥æ‰¾ return text.trim() åœ¨ page.evaluate å‡½æ•°å†…çš„ä½ç½®
in_evaluate = False
for i, line in enumerate(lines):
    if 'content = await page.evaluate' in line:
        in_evaluate = True
        evaluate_start = i
    if in_evaluate and '});' in line:
        evaluate_end = i
        break

# åœ¨ evaluate å‡½æ•°å†…æŸ¥æ‰¾ return text.trim()
for i in range(evaluate_start, evaluate_end):
    if 'return text.trim()' in lines[i]:
        # åœ¨è¿™è¡Œå‰æ·»åŠ éªŒè¯
        indent = len(lines[i]) - len(lines[i].lstrip())
        indent_str = ' ' * indent
        # æ’å…¥éªŒè¯ä»£ç 
        lines.insert(i, f"{indent_str}// éªŒè¯å†…å®¹ï¼šæ’é™¤å¯¼èˆªæ \n")
        lines.insert(i+1, f"{indent_str}if (text.includes('Help Center') || text.includes('Keyboard Shortcuts') || text.includes('Token Limit') || text.trim().split(/\\s+/).length < 10 || (!/[\\u4e00-\\u9fa5]/.test(text) && text.length < 200)) {{\n")
        lines.insert(i+2, f"{indent_str}  continue;\n")
        lines.insert(i+3, f"{indent_str}}}\n")
        print(f"âœ… åœ¨ç¬¬ {i+1} è¡Œå‰æ·»åŠ éªŒè¯")
        break

with open('feishu-puppeteer.ts.bak11', 'w', encoding='utf-8') as f:
    f.writelines(lines)
with open('feishu-puppeteer.ts', 'w', encoding='utf-8') as f:
    f.writelines(lines)
PYEOF

cd /www/wwwroot/feihub/backend
npm run build && pm2 restart feihub-backend
```

---

è¯·å…ˆæ‰§è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤æŸ¥çœ‹ä»£ç ç»“æ„ï¼ŒæŠŠè¾“å‡ºå‘ç»™æˆ‘ï¼Œæˆ‘ä¼šæä¾›ç²¾ç¡®çš„ä¿®å¤æ–¹æ¡ˆã€‚

