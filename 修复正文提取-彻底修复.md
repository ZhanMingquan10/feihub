# ä¿®å¤æ­£æ–‡æå–é—®é¢˜ - å½»åº•ä¿®å¤æ–¹æ¡ˆ

## ğŸ” é—®é¢˜æ ¹æº

å†…å®¹æå–æ—¶è·å–åˆ°äº†å¯¼èˆªæ å†…å®¹ï¼ˆ"Help Center"ã€"Keyboard Shortcuts"ã€"Token Limit"ï¼‰ï¼Œéœ€è¦æ›´å½»åº•åœ°æ’é™¤è¿™äº›å†…å®¹ã€‚

## ğŸš€ ä¿®å¤æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥å®é™…ä½¿ç”¨çš„æ–‡ä»¶

```bash
cd /www/wwwroot/feihub/backend/src/lib

# åˆ—å‡ºæ‰€æœ‰ feishu ç›¸å…³æ–‡ä»¶
ls -la feishu*.ts

# æ£€æŸ¥å“ªä¸ªæ–‡ä»¶è¢«å®é™…ä½¿ç”¨
cd ../services
grep "from.*feishu" documentProcessor.ts
```

### ç¬¬äºŒæ­¥ï¼šæ ¹æ®æ–‡ä»¶ç±»å‹ä¿®å¤

**å¦‚æœæ‰¾åˆ° `feishu-puppeteer.ts`ï¼š**

è¿™ä¸ªæ–‡ä»¶å¯èƒ½åŒ…å«æ›´å¤æ‚çš„å†…å®¹æå–é€»è¾‘ï¼Œéœ€è¦ä¿®æ”¹å…¶ä¸­çš„å†…å®¹æå–éƒ¨åˆ†ã€‚

**å¦‚æœåªæœ‰ `feishu-server.ts`ï¼š**

æˆ‘å·²ç»ä¿®æ”¹äº†è¿™ä¸ªæ–‡ä»¶ï¼Œä½†å¯èƒ½æœåŠ¡å™¨ä¸Šçš„ä»£ç è¿˜æ²¡æ›´æ–°ã€‚

### ç¬¬ä¸‰æ­¥ï¼šæ”¹è¿›å†…å®¹æå–é€»è¾‘ï¼ˆå…³é”®ä¿®å¤ï¼‰

æ— è®ºä½¿ç”¨å“ªä¸ªæ–‡ä»¶ï¼Œéƒ½éœ€è¦åœ¨å†…å®¹æå–åæ·»åŠ ä»¥ä¸‹è¿‡æ»¤é€»è¾‘ï¼š

```typescript
// åœ¨æå–æ–‡æœ¬åï¼Œè¿”å›å‰æ·»åŠ ï¼š
const text = cloned.innerText || cloned.textContent || '';

// æ·»åŠ è¿‡æ»¤ï¼šæ’é™¤å¯¼èˆªæ å’Œå¸®åŠ©ä¸­å¿ƒå†…å®¹
if (text && (
    text.includes('Help Center') || 
    text.includes('Keyboard Shortcuts') ||
    text.includes('Token Limit') ||
    text.includes('å¿«æ·é”®') ||
    text.trim().split(/\s+/).length < 10 || // å¤ªçŸ­çš„å†…å®¹
    (!/[\u4e00-\u9fa5]/.test(text) && text.length < 200) // æ²¡æœ‰ä¸­æ–‡ä¸”å¤ªçŸ­
)) {
    continue; // è·³è¿‡è¿™ä¸ªå…ƒç´ ï¼Œå°è¯•ä¸‹ä¸€ä¸ª
}

// å¦‚æœæ–‡æœ¬åŒ…å«ä¸­æ–‡æˆ–è¶³å¤Ÿé•¿ï¼Œæ‰è¿”å›
if (text.length > 100 && (
    /[\u4e00-\u9fa5]/.test(text) || // åŒ…å«ä¸­æ–‡
    text.split(/\s+/).length > 20 // æˆ–åŒ…å«è¶³å¤Ÿå¤šçš„å•è¯
)) {
    return text.trim();
}
```

### ç¬¬å››æ­¥ï¼šåœ¨ body æå–æ—¶ä¹Ÿè¦è¿‡æ»¤

```typescript
let bodyText = (body.innerText || body.textContent || '').trim();

// ç§»é™¤å¸¸è§çš„å¯¼èˆªæ–‡æœ¬
bodyText = bodyText
    .replace(/Help Center[^\n]*/gi, '')
    .replace(/Keyboard Shortcuts[^\n]*/gi, '')
    .replace(/Token Limit[^\n]*/gi, '')
    .replace(/å¿«æ·é”®[^\n]*/gi, '')
    .replace(/\s+/g, ' ')
    .trim();

// å¦‚æœè¿‡æ»¤åå†…å®¹å¤ªçŸ­æˆ–æ²¡æœ‰ä¸­æ–‡ï¼Œè¿”å›ç©º
if (bodyText.length < 100 || (!/[\u4e00-\u9fa5]/.test(bodyText) && bodyText.length < 200)) {
    bodyText = '';
}

return bodyText;
```

---

## ğŸ“ å¿«é€Ÿä¿®å¤å‘½ä»¤

è¯·å…ˆåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç¬¬ä¸€æ­¥ï¼ŒæŠŠè¾“å‡ºå‘ç»™æˆ‘ï¼Œæˆ‘ä¼šæ ¹æ®å®é™…æƒ…å†µæä¾›å…·ä½“çš„ä¿®å¤ä»£ç ã€‚

æˆ–è€…ï¼Œå¦‚æœä½ çŸ¥é“ä½¿ç”¨çš„æ˜¯å“ªä¸ªæ–‡ä»¶ï¼Œå‘Šè¯‰æˆ‘æ–‡ä»¶åï¼Œæˆ‘å¯ä»¥ç›´æ¥æä¾›ä¿®å¤ä»£ç ã€‚

