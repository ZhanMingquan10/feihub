# 修改反向代理配置

## 问题说明

默认配置 `location ^~ /` 会将所有请求都代理到后端，这是不对的。

我们需要：
- `/api/*` 请求 → 代理到后端（`http://127.0.0.1:4000`）
- 其他请求 → 直接服务静态文件（`/www/wwwroot/feihub/dist`）

---

## 🔧 正确的配置

将默认配置替换为以下内容：

```nginx
#PROXY-START/

location /api {
    proxy_pass http://127.0.0.1:4000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_http_version 1.1;
}

#PROXY-END/
```

---

## 📝 修改步骤

1. **删除默认配置**
   - 选中并删除整个默认配置块（从 `#PROXY-START/` 到 `#PROXY-END/`）

2. **添加新配置**
   - 粘贴上面的正确配置

3. **保存配置**
   - 点击 **"保存"** 按钮

4. **重载 Nginx**
   - 如果提示重载 Nginx，点击 **"重载"**

---

## ✅ 验证配置

配置完成后，测试：

1. **访问网站**：`http://feihub.top`（或 `https://feihub.top`）
   - 应该能看到网站首页（静态文件）

2. **测试 API**：在浏览器开发者工具（F12）中
   - 打开 **"网络"**（Network）标签
   - 刷新页面
   - 查看是否有 `/api/` 开头的请求
   - 这些请求应该成功（状态码 200）

---

## 🆘 如果配置后网站无法访问

如果配置后网站无法访问，可能是配置有误。可以：

1. **临时恢复默认配置**（测试用）
2. **检查 Nginx 配置语法**：
   ```bash
   nginx -t
   ```
3. **查看 Nginx 错误日志**：
   ```bash
   tail -f /www/server/nginx/logs/error.log
   ```

---

## 📋 配置说明

- `location /api`：只匹配以 `/api` 开头的请求
- `proxy_pass http://127.0.0.1:4000`：代理到后端服务
- 其他请求（如 `/`、`/index.html` 等）会直接服务静态文件

---

## 🎯 现在执行

1. **删除默认配置**
2. **添加上面的正确配置**
3. **保存并重载 Nginx**
4. **测试网站访问**

完成后告诉我结果，我们继续！


