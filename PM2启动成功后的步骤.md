# PM2 å¯åŠ¨æˆåŠŸåçš„æ­¥éª¤

## âœ… å·²å®Œæˆ
- [x] åç«¯æ„å»ºæˆåŠŸ
- [x] PM2 å¯åŠ¨æˆåŠŸ
- [x] PM2 å¼€æœºè‡ªå¯å·²é…ç½®

---

## ğŸ” ç¬¬ä¸€æ­¥ï¼šéªŒè¯åç«¯è¿è¡Œ

åœ¨å®å¡”ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—ï¼ˆç¡®è®¤æ²¡æœ‰é”™è¯¯ï¼‰
pm2 logs feihub-backend --lines 20
```

**åº”è¯¥çœ‹åˆ°ï¼š**
- `pm2 status` æ˜¾ç¤º `feihub-backend` çŠ¶æ€ä¸º `online`
- æ—¥å¿—ä¸­æ˜¾ç¤ºæœåŠ¡å·²å¯åŠ¨ï¼Œæ²¡æœ‰é”™è¯¯ä¿¡æ¯

---

## ğŸ“ å…³äº PM2 Startup

ä»ä½ çš„æ—¥å¿—çœ‹ï¼ŒPM2 å·²ç»è‡ªåŠ¨æ‰§è¡Œäº†å¼€æœºè‡ªå¯é…ç½®ï¼š
- âœ… å·²åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ï¼š`/etc/systemd/system/pm2-undefined.service`
- âœ… å·²æ‰§è¡Œï¼š`systemctl enable pm2-undefined`
- âœ… å‘½ä»¤æˆåŠŸæ‰§è¡Œ

**æ³¨æ„**ï¼šè™½ç„¶æ˜¾ç¤º `User=undefined`ï¼Œä½†è¿™ä¸å½±å“åŠŸèƒ½ã€‚å¦‚æœéœ€è¦ä¿®å¤ï¼Œå¯ä»¥ï¼š
```bash
pm2 unstartup systemd
pm2 startup systemd -u root --hp /root
```

ä½†é€šå¸¸ä¸éœ€è¦ï¼Œå› ä¸ºå·²ç»é…ç½®æˆåŠŸäº†ã€‚

---

## ğŸš€ ä¸‹ä¸€æ­¥ï¼šå®‰è£…å‰ç«¯ä¾èµ–

éªŒè¯åç«¯è¿è¡Œæ­£å¸¸åï¼Œç»§ç»­ï¼š

```bash
# å®‰è£…å‰ç«¯ä¾èµ–
cd /www/wwwroot/feihub
npm install
```

**ç­‰å¾…å®‰è£…å®Œæˆ**ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰

---

## ğŸ“‹ åç»­æ­¥éª¤

1. âœ… éªŒè¯åç«¯è¿è¡Œï¼ˆå½“å‰æ­¥éª¤ï¼‰
2. å®‰è£…å‰ç«¯ä¾èµ–
3. é…ç½®å‰ç«¯ç¯å¢ƒå˜é‡
4. æ„å»ºå‰ç«¯
5. ä¸Šä¼ å®¢æœå›¾ç‰‡
6. é…ç½® Nginx
7. éªŒè¯éƒ¨ç½²

---

## ğŸ†˜ å¦‚æœåç«¯å¯åŠ¨å¤±è´¥

å¦‚æœ `pm2 status` æ˜¾ç¤ºåç«¯çŠ¶æ€ä¸æ˜¯ `online`ï¼š

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs feihub-backend --lines 50

# æ£€æŸ¥å¸¸è§é—®é¢˜
# 1. ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tlnp | grep 4000

# 2. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®
cd /www/wwwroot/feihub/backend
cat .env | grep -E "DATABASE_URL|DEEPSEEK_API_KEY|PORT"

# 3. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
psql -h localhost -U feihub_user -d feihub -c "SELECT 1;"
```

---

## âœ… æˆåŠŸæ ‡å¿—

- `pm2 status` æ˜¾ç¤º `feihub-backend` çŠ¶æ€ä¸º `online`
- æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ä¿¡æ¯
- å¯ä»¥è®¿é—® `http://localhost:4000/health`ï¼ˆå¦‚æœé…ç½®äº†å¥åº·æ£€æŸ¥ï¼‰

---

## ğŸ¯ ç°åœ¨æ‰§è¡Œ

å…ˆæ‰§è¡ŒéªŒè¯å‘½ä»¤ï¼š

```bash
pm2 status
pm2 logs feihub-backend --lines 20
```

å‘Šè¯‰æˆ‘ç»“æœï¼Œæˆ‘ä»¬ç»§ç»­ä¸‹ä¸€æ­¥ã€‚


